import{a as ki,b as Te}from"./chunk-TJQN6HPD.js";import{a as Oi,b as ce}from"./chunk-WW3RI7SE.js";import{a as _e,b as re}from"./chunk-XOKCTS6A.js";import{a as Ae,b as Ne,e as oe,g as Mi,k as Ui,l as Gi,m as ne,o as P,p as Pi,q as pe}from"./chunk-UOPNTX3M.js";import{c as Ge,d as G,f as Ie}from"./chunk-JNSMYR6G.js";import{m as ie,n as $,q as Vi,r as We,u as wi,x as Ze}from"./chunk-RKSKOFBD.js";import{b as Q,c as v,e as q,f as W,g as he,h as xi,i as Pe,k as Z,l as Ye,m as Qe,n as J,r as K,s as le,t as z,w as te,x as H}from"./chunk-HPGERUHF.js";import{e as Ri,f as ee,g as X}from"./chunk-VNHB2M7P.js";import{a as B}from"./chunk-3HDNW6W4.js";import{b as V,c as w,d as x}from"./chunk-TI22M3TN.js";import{i as Bi,n as ae}from"./chunk-CVH3MUVM.js";import{$a as E,Ac as Ue,Cc as Xe,Dc as fe,Eb as d,Fb as C,Gb as _,Gc as Se,Ia as be,Ib as He,J as Re,Jb as qe,K as b,Kb as ze,Lb as Li,Lc as L,Ma as n,Mb as F,Na as f,Nb as A,O as Ce,Ob as S,T as ve,Xb as o,Y as D,Yb as c,Zb as g,bb as p,eb as Di,f as R,ga as M,ha as U,hb as O,j as Ee,lb as s,mb as r,n as ge,na as yi,nb as I,ob as Ve,pb as we,rb as j,tb as h,ub as N,v as Be,xb as Fi,y as xe,yb as Me}from"./chunk-FUWWX4DR.js";import{a as T,b as y}from"./chunk-4CLCTAJ7.js";var Je=(()=>{class t{_http;constructor(e){this._http=e}deleteClassification(e){return this._http.delete(`${B.URL_API}Classifications/${e}`)}addClassification(e){return this._http.post(`${B.URL_API}Classifications`,e)}editClassification(e){return this._http.put(`${B.URL_API}Classifications`,e)}getAllClassifications(e){return this._http.get(`${B.URL_API}Classifications?PageSize=${e.size}&PageNumber=${e.number}`)}getClassificationById(e){return this._http.get(`${B.URL_API}Classifications/${e}`)}uploadGalaryImage(e){let a=new FormData;return a.append("file",e),this._http.post(`${B.URL_API}BlobsStore/file`,a)}getAllMerchantClassification(){return this._http.get(`${B.URL_API}Merchants/Classifications`)}static \u0275fac=function(a){return new(a||t)(ve(Ie))};static \u0275prov=Ce({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var $i={columns:[{field:"id",header:"ID",type:"label",exported:!1},{field:"name",header:"CLASSIFICATION",type:"label",exported:!1},{field:"actions",header:"ACTIONS",type:"actions",exported:!1}],rowsPerPage:10,rowsPerPageOptions:[5,10,15,20,25,50,100],selectionMode:"single",locale:"FIELDS.",actions:["CREATE"],rowsActions:["EDIT","DELETE"],dataLoading:"client",paginator:!0,globalFilterFields:["name"]};var di=function(t){return t[t.NoService=0]="NoService",t[t.Maintenance=1]="Maintenance",t[t.Pets=2]="Pets",t}(di||{});var mi=t=>({"ng-dirty ng-invalid":t}),fi=t=>({fieldName:t}),hi=()=>({maxLength:50});function at(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,fi,c(2,1,"FIELDS.SERVICE_TYPE")))," "))}function nt(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,fi,c(2,1,"FIELDS.ENGLISH_NAME")))," "))}function rt(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,hi))," "))}function ot(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,fi,c(2,1,"FIELDS.ARABIC_NAME")))," "))}function st(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,hi))," "))}function lt(t,u){if(t&1){let e=j();s(0,"div",11),I(1,"img",15),s(2,"img",16),h("click",function(){M(e);let i=N();return U(i.removeFile())}),r()()}if(t&2){let e=N();n(),p("src",e.classification.icon==null?null:e.classification.icon.blobUrI,be)("alt",e.classification.icon==null?null:e.classification.icon.id)}}function pt(t,u){if(t&1){let e=j();s(0,"label",17),d(1,"Classification Icon"),r(),s(2,"p-fileUpload",18),h("onSelect",function(i){M(e);let l=N();return U(l.uploadFile(i))}),r()}t&2&&(n(2),p("showUploadButton",!1)("showCancelButton",!1)("maxFileSize",1e6))}function ct(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.FIELD_REQUIRED",A(4,hi))," "))}var _i=(()=>{class t{_classifications;_popup;_translate;_toastr;_fb;destroy$=new R;formError;classificationsForm;classification;serviceTypes;constructor(e,a,i,l,m){this._classifications=e,this._popup=a,this._translate=i,this._toastr=l,this._fb=m}ngOnInit(){this.classification=this._popup.getData(),this.serviceTypes=Oi.getEnumOptions(di),this.classificationsForm=this.initForm(),this.formError=new Ge.ErrorManagement(this.classificationsForm),this.classification.id&&this.getClassificationDetails()}getClassificationDetails(){this._classifications.getClassificationById(this.classification.id).pipe(b(this.destroy$)).subscribe(e=>{this.classification=e.data,this.classification.id&&this.patchFormData()})}initForm(){return this._fb.group({id:[0],arabicName:["",[v.required,v.maxLength(50)]],englishName:["",[v.required,v.maxLength(50)]],serviceType:[null,[v.required]],icon:this._fb.group({id:0,externalStorageId:"",mimeType:"",has360View:!1,sizeInBytes:0,blobUrI:""})})}patchFormData(){this.classificationsForm.patchValue({id:this.classification.id,arabicName:this.classification.arabicName,englishName:this.classification.englishName,serviceType:this.classification.serviceType,icon:this.classification.icon});let e=this.classificationsForm.get("icon");this.classification.icon&&e.patchValue({id:this.classification.icon.id,externalStorageId:this.classification.icon.externalStorageId,mimeType:this.classification.icon.mimeType,has360View:this.classification.icon.has360View,sizeInBytes:this.classification.icon.sizeInBytes,blobUrI:this.classification.icon.blobUrI})}uploadFile(e){let a=e.files;if(a.length>0){let i=a[0];this.classificationsForm.get("icon").patchValue({id:0,externalStorageId:i.name,mimeType:i.type,sizeInBytes:i.size,has360View:!0,blobUrl:URL.createObjectURL(i)})}}removeFile(){this.classificationsForm.get("icon")?.get("blobUrI")?.setValue(""),this.classification.icon&&(this.classification.icon.blobUrI=void 0)}save(){let e=this.classificationsForm.getRawValue();(e.id?this._classifications.editClassification(e):this._classifications.addClassification(e)).pipe(b(this.destroy$)).subscribe(()=>this.afterSavingDone(e.id?"edit":"add",e))}afterSavingDone(e,a){let i=this._translate.currentLang==="ar"?a?.arabicName:a?.englishName;this._translate.get(e?"GENERAL.ADDED_SUCCESSFULLY":"UPDATED_SUCCESSFULLY",{name:i}).subscribe(l=>this._toastr.success(l)),this._popup.close(!0)}close=()=>this._popup.close();static \u0275fac=function(a){return new(a||t)(f(Je),f(P),f(V),f(G),f(K))};static \u0275cmp=D({type:t,selectors:[["admin-classification-form"]],standalone:!0,features:[F],decls:35,vars:47,consts:[["autocomplete","off",3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12"],["for","serviceType"],["formControlName","serviceType","optionLabel","label","optionValue","value","filterBy","label",1,"w-full",3,"options","ngClass","filter","showClear","placeholder"],["id","serviceType-error",1,"text-error"],[1,"field","col-12","md:col-6"],["for","englishName"],["pInputText","","type","text","pInputText","","formControlName","englishName",1,"w-full",3,"ngClass","placeholder"],["for","arabicName"],["type","text","pInputText","","formControlName","arabicName",1,"w-full",3,"ngClass","placeholder"],[1,"container-img"],[1,"flex","gap-2","align-items-center","justify-content-end"],["severity","danger",3,"onClick","label"],["severity","primary",3,"onClick","disabled","label"],[3,"src","alt"],["src","assets/layout/images/close-icon.svg","alt","close-icon",1,"close",3,"click"],["for","icon"],["name","icon","id","icon","invalidFileTypeMessageSummary","Invalid Type","invalidFileLimitMessageDetail","Invalid Type","accept","image/*",3,"onSelect","showUploadButton","showCancelButton","maxFileSize"]],template:function(a,i){a&1&&(s(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),d(4),o(5,"translate"),r(),I(6,"p-dropdown",4),o(7,"translate"),E(8,at,4,8,"small",5),r(),s(9,"div",6)(10,"label",7),d(11),o(12,"translate"),r(),I(13,"input",8),o(14,"translate"),E(15,nt,4,8,"small",5)(16,rt,3,5,"small",5),r(),s(17,"div",6)(18,"label",9),d(19),o(20,"translate"),r(),I(21,"input",10),o(22,"translate"),E(23,ot,4,8,"small",5)(24,st,3,5,"small",5),r(),s(25,"div",2),E(26,lt,3,2,"div",11)(27,pt,3,3)(28,ct,3,5,"small",5),r()()(),s(29,"div",12)(30,"p-button",13),o(31,"translate"),h("onClick",function(){return i.close()}),r(),s(32,"p-button",14),o(33,"translate"),o(34,"translate"),h("onClick",function(){return i.save()}),r()()),a&2&&(p("formGroup",i.classificationsForm),n(4),C(c(5,23,"FIELDS.SERVICE_TYPE")),n(2),p("options",i.serviceTypes)("ngClass",S(41,mi,i.formError.hasError("serviceType")))("filter",!0)("showClear",!0)("placeholder",c(7,25,"FIELDS.SERVICE_TYPE")),n(2),O(i.formError.hasSpecificError("serviceType","required")?8:-1),n(3),C(c(12,27,"FIELDS.ENGLISH_NAME")),n(2),p("ngClass",S(43,mi,i.formError.hasError("englishName")))("placeholder",c(14,29,"FIELDS.ENGLISH_NAME")),n(2),O(i.formError.hasSpecificError("englishName","required")?15:-1),n(),O(i.formError.hasSpecificError("englishName","maxlength")?16:-1),n(3),C(c(20,31,"FIELDS.ARABIC_NAME")),n(2),p("ngClass",S(45,mi,i.formError.hasError("arabicName")))("placeholder",c(22,33,"FIELDS.ARABIC_NAME")),n(2),O(i.formError.hasSpecificError("arabicName","required")?23:-1),n(),O(i.formError.hasSpecificError("arabicName","maxlength")?24:-1),n(2),O(i.classification.icon!=null&&i.classification.icon.blobUrI?26:27),n(2),O(i.formError.hasSpecificError("icon","required")?28:-1),n(2),p("label",c(31,35,"GENERAL.CANCEL")),n(2),p("disabled",i.classificationsForm.invalid)("label",i.classification.id?c(33,37,"GENERAL.UPDATE"):c(34,39,"GENERAL.SAVE")))},dependencies:[L,Ue,z,Pe,Q,q,W,Z,J,$,ie,H,te,Ne,Ae,ee,X,x,w],styles:[".container-img[_ngcontent-%COMP%]{width:160px;height:124px;border:2px solid #ff7f3e;border-radius:8px;overflow:hidden;position:relative}.container-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.container-img[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;top:4px;inset-inline-end:4px;cursor:pointer;height:20px;width:20px;background:#ff7f3e;padding:5px;border-radius:50%}"]})}return t})();var un=(()=>{class t{_classifications;_confirm;_translate;_popup;_toast;destroy$=new R;tableConfig$;filters={number:1,size:10};constructor(e,a,i,l,m){this._classifications=e,this._confirm=a,this._translate=i,this._popup=l,this._toast=m}ngOnInit(){this.getAllClassifications(this.filters)}onActionClicked(e){switch(e.action){case"CREATE":this.createClassification();break;case"EDIT":this.editClassification(e.data);break;case"DELETE":this.deleteClassification(e.data);break}}getAllClassifications(e){this.tableConfig$=this._classifications.getAllClassifications(e).pipe(ge(a=>y(T({},$i),{rows:a.data?.classifications,totalRecords:a.data.rowCount})))}createClassification(){this._popup.open(_i,{title:this._translate.instant("CLASSIFICATIONS.ADD_NEW_CLASSIFICATION"),position:this._translate.currentLang==="ar"?"left":"right"}).afterClosed.subscribe(e=>e&&this.getAllClassifications(this.filters))}editClassification(e){this._popup.open(_i,{title:this._translate.instant("CLASSIFICATIONS.EDIT_CLASSIFICATION"),position:this._translate.currentLang==="ar"?"left":"right",data:e}).afterClosed.subscribe(a=>a&&this.getAllClassifications(this.filters))}deleteClassification(e){e.id&&this._confirm.confirm("delete").subscribe(a=>{a&&this._classifications.deleteClassification(e.id).pipe(b(this.destroy$)).subscribe(()=>{this._toast.success(this._translate.instant("CLASSIFICATIONS.DELETE_CLASSIFICATION_SUCCESS")),this.getAllClassifications(this.filters)})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(a){return new(a||t)(f(Je),f(ne),f(V),f(P),f(G))};static \u0275cmp=D({type:t,selectors:[["admin-classifications"]],standalone:!0,features:[F],decls:2,vars:3,consts:[[3,"actionClicked","config"]],template:function(a,i){a&1&&(s(0,"shared-ui-table",0),o(1,"async"),h("actionClicked",function(m){return i.onActionClicked(m)}),r()),a&2&&p("config",c(1,1,i.tableConfig$))},dependencies:[L,Se,oe,pe,x],encapsulation:2})}return t})();var ti=t=>({fieldName:t}),gi=()=>({maxLength:50});function dt(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,ti,c(2,1,"FIELDS.CLASSIFICATION")))," "))}function mt(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,ti,c(2,1,"FIELDS.BAR_CODE_NO")))," "))}function ut(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,gi))," "))}function ft(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,ti,c(2,1,"FIELDS.SHORT_ARABIC_NAME")))," "))}function ht(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,gi))," "))}function _t(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,ti,c(2,1,"FIELDS.ENGLISH_NAME")))," "))}function gt(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,gi))," "))}function Et(t,u){if(t&1){let e=j();Ve(0),s(1,"p-fileUpload",19),o(2,"translate"),h("onSelect",function(i){M(e);let l=N();return U(l.onFileSelect(i))}),r(),we()}t&2&&(n(),p("chooseLabel",c(2,1,"GENERAL.CHOOSE")))}function Ct(t,u){if(t&1){let e=j();Ve(0),s(1,"div",20),I(2,"img",21),s(3,"img",22),h("click",function(){M(e);let i=N();return U(i.removeImage())}),r()(),we()}if(t&2){let e=N();n(2),p("src",e.data==null||e.data.response==null||e.data.response.icon==null?null:e.data.response.icon.blobUrI,be)("alt",e.data==null||e.data.response==null||e.data.response.icon==null?null:e.data.response.icon.id)}}function vt(t,u){if(t&1){let e=j();s(0,"div",12)(1,"p-button",23),o(2,"translate"),h("click",function(){M(e);let i=N();return U(i.onActionClicked({action:"ADD_SUB_CATEGORY",data:i.data}))}),r()()}t&2&&(n(),Fi("label",c(2,1,"CATEGORY.ADD_SUB_CATEGORY")))}function bt(t,u){t&1&&(s(0,"tr")(1,"th"),d(2,"#"),r(),s(3,"th"),d(4),o(5,"translate"),r(),s(6,"th"),d(7),o(8,"translate"),r()()),t&2&&(n(4),C(c(5,2,"FIELDS.CATEGORY_NAME")),n(3),C(c(8,4,"FIELDS.ACTIONS")))}function St(t,u){if(t&1){let e=j();s(0,"tr")(1,"td"),d(2),r(),s(3,"td"),d(4),r(),s(5,"td")(6,"div",28)(7,"button",29),h("click",function(){let i=M(e).$implicit,l=N(2);return U(l.onActionClicked({action:"DELETE",data:i}))}),I(8,"i",30),s(9,"span"),d(10),o(11,"translate"),r()(),s(12,"button",31),h("click",function(){let i=M(e).$implicit,l=N(2);return U(l.onActionClicked({action:"EDIT_SUB_CATEGORY",data:i}))}),I(13,"i",32),s(14,"span"),d(15),o(16,"translate"),r()()()()()}if(t&2){let e=u.$implicit;n(2),C(e.id),n(2),C(e.name),n(6),C(c(11,4,"GENERAL.DELETE")),n(5),C(c(16,6,"GENERAL.UPDATE"))}}function It(t,u){if(t&1&&(s(0,"div",12)(1,"div",24)(2,"p-table",25),E(3,bt,9,6,"ng-template",26)(4,St,17,8,"ng-template",27),r()()()),t&2){let e=N();n(2),p("value",e.subCatagory)}}var Ei=(()=>{class t{_fb;_popup;_translate;_confirm;_toastr;_product;destroy$=new R;classifications=[];data;subCatagory=[];dialogForm;_unsubscribeAll=new R;constructor(e,a,i,l,m,k){this._fb=e,this._popup=a,this._translate=i,this._confirm=l,this._toastr=m,this._product=k}ngOnInit(){this.prepareForm(),this.data=this._popup.getData(),this.classifications=this.data?.classifications,this.data?.response&&(this.dialogForm.patchValue(this.data?.response),this.setPreSelectedValues(),this.getAllCategories())}prepareForm(){this.dialogForm=this._fb.group({arabicName:[null,[v.required,v.maxLength(50)]],englishName:[null,[v.required,v.maxLength(50)]],classificationsIds:[null],id:[this.data?.response?.id],classifications:[null,v.required],barcodeNumber:[null,v.required],icon:this._fb.group({externalStorageId:"",mimeType:"",sizeInBytes:0,blobUrI:""})})}get control(){return this.dialogForm.controls}getAllCategories(){this._product.getAllCategories(1e5,1,"").subscribe(e=>{let a=e.data.result,i=this.data?.response?.id,l=a.filter(m=>m.id==i);l&&(this.subCatagory=l[0]?.subCategories?l[0]?.subCategories:[],console.log("this.subCatagorythis.subCatagorythis.subCatagory",this.subCatagory))})}onClassificationChange(e){let a=e.value.map(i=>i.id);this.dialogForm.get("classificationsIds")?.setValue(a),this.dialogForm.get("classifications")?.setValue(e.value)}setPreSelectedValues(){let e=this.data?.response?.classifications.map(i=>this.classifications.find(l=>l.id===i.id)),a=e?.map(i=>i?.id);this.dialogForm.get("classificationsIds")?.setValue(a),this.dialogForm.patchValue({classifications:e})}save(){let e=this.dialogForm.getRawValue();(this.data?.response?this._product.editCategory(e):this._product.addCategory(e)).pipe(b(this.destroy$)).subscribe(()=>this.afterSavingDone(this.data?.response?"edit":"add",e))}afterSavingDone(e,a){let i=this._translate.currentLang==="ar"?a?.arabicName:a?.englishName;this._translate.get(e=="add"?"GENERAL.ADDED_SUCCESSFULLY":"GENERAL.UPDATED_SUCCESSFULLY",{name:i}).subscribe(l=>this._toastr.success(l)),this._popup.close(!0)}removeImage(){this.data?.response&&this.data?.response?.icon&&(this.data.response.icon.blobUrI=null)}onFileSelect(e){if(e.files&&e.files[0]){let a=e.files[0];this.uploadImage(a).subscribe(i=>{this.updateFormWithResponse(i.data)},i=>{console.error("Error during image upload:",i)})}}uploadImage(e){let a=new FormData;return a.append("file",e),this._product.uploadGalaryImage(a)}updateFormWithResponse(e){this.dialogForm.get("icon")?.setValue({externalStorageId:e.externalStorageId,mimeType:e.mimeType,sizeInBytes:e.sizeInBytes,blobUrI:e.blobUrI})}onActionClicked(e){switch(e.action){case"ADD_SUB_CATEGORY":this.addSubcategory(e.data);break;case"EDIT_SUB_CATEGORY":this.editSubcategory(e.data);break;case"DELETE":this.onActionDelete(e.data);break}}editSubcategory(e){console.log("data",e),this._product.getCategoryById(Number(e?.id)).subscribe(a=>{this._popup.close({action:"EDIT_SUB_CATEGORY",data:a})})}addSubcategory(e){this._popup.close({action:"ADD_SUB_CATEGORY",data:e?.response})}onActionDelete(e){this._confirm.confirm("delete").subscribe(a=>{a&&this._product.deleteCategory(e.id).pipe(b(this._unsubscribeAll)).subscribe(i=>{i.data&&this.close()})})}close=()=>this._popup.close();static \u0275fac=function(a){return new(a||t)(f(K),f(P),f(V),f(ne),f(G),f(ce))};static \u0275cmp=D({type:t,selectors:[["admin-add-edit-category"]],standalone:!0,features:[Li([Bi]),F],decls:45,vars:46,consts:[[1,"form-content",3,"formGroup"],[1,"row"],[1,"col-6"],["for","classification",1,"mb-2","block"],["formControlName","classifications","optionLabel","name",3,"onChange","options","placeholder"],["class","error-message",4,"ngIf"],["for","barcodeNumber",1,"mb-2","block"],["pInputText","","appOnlyNumbers","","formControlName","barcodeNumber",1,"w-full",3,"placeholder"],["for","arabicName",1,"mb-2","block"],["type","text","pInputText","","formControlName","arabicName",1,"w-full",3,"placeholder"],["for","englishName",1,"mb-2","block"],["type","text","pInputText","","formControlName","englishName",1,"w-full",3,"placeholder"],[1,"col-12"],[4,"ngIf"],["class","col-12",4,"ngIf"],[1,"flex","gap-2","align-items-center","justify-content-end"],["severity","danger",3,"onClick","label"],["severity","primary",3,"onClick","label","disabled"],[1,"error-message"],["mode","basic","chooseIcon","pi pi-upload","name","demo[]","accept","image/*","maxFileSize","1000000",3,"onSelect","chooseLabel"],[1,"container-img"],[3,"src","alt"],["src","assets/layout/images/close-icon.svg","alt","close-icon",1,"close",3,"click"],[3,"click","label"],[1,"table-container"],[1,"p-table",3,"value"],["pTemplate","header"],["pTemplate","body"],[1,"flex","align-items-center","gap-2"],["pButton","","type","button","severity","danger",1,"flex","align-items-center","gap-2",3,"click"],[1,"pi","pi-trash"],["pButton","","type","button",1,"flex","align-items-center","gap-2",3,"click"],[1,"pi","pi-pencil"]],template:function(a,i){a&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),d(4),o(5,"translate"),r(),s(6,"p-multiSelect",4),o(7,"translate"),h("onChange",function(m){return i.onClassificationChange(m)}),r(),E(8,dt,4,8,"div",5),r(),s(9,"div",2)(10,"label",6),d(11),o(12,"translate"),r(),I(13,"input",7),o(14,"translate"),E(15,mt,4,8,"div",5)(16,ut,3,5,"div",5),r(),s(17,"div",2)(18,"label",8),d(19),o(20,"translate"),r(),I(21,"input",9),o(22,"translate"),E(23,ft,4,8,"div",5)(24,ht,3,5,"div",5),r(),s(25,"div",2)(26,"label",10),d(27),o(28,"translate"),r(),I(29,"input",11),o(30,"translate"),E(31,_t,4,8,"div",5)(32,gt,3,5,"div",5),r(),s(33,"div",12),E(34,Et,3,3,"ng-container",13)(35,Ct,4,2,"ng-container",13),r(),E(36,vt,3,3,"div",14)(37,It,5,1,"div",14),s(38,"div",12)(39,"div",15)(40,"p-button",16),o(41,"translate"),h("onClick",function(){return i.close()}),r(),s(42,"p-button",17),o(43,"translate"),o(44,"translate"),h("onClick",function(){return i.save()}),r()()()()()),a&2&&(p("formGroup",i.dialogForm),n(4),C(c(5,24,"FIELDS.CLASSIFICATION")),n(2),p("options",i.classifications)("placeholder",c(7,26,"FIELDS.CLASSIFICATION")),n(2),p("ngIf",i.control.classifications.touched&&(i.control.classifications.errors==null?null:i.control.classifications.errors.required)),n(3),C(c(12,28,"FIELDS.BAR_CODE_NO")),n(2),p("placeholder",c(14,30,"FIELDS.BAR_CODE_NO")),n(2),p("ngIf",i.control.barcodeNumber.touched&&(i.control.barcodeNumber.errors==null?null:i.control.barcodeNumber.errors.required)),n(),p("ngIf",i.control.barcodeNumber.touched&&(i.control.barcodeNumber.errors==null?null:i.control.barcodeNumber.errors.maxlength)),n(3),C(c(20,32,"FIELDS.SHORT_ARABIC_NAME")),n(2),p("placeholder",c(22,34,"FIELDS.SHORT_ARABIC_NAME")),n(2),p("ngIf",i.control.arabicName.touched&&(i.control.arabicName.errors==null?null:i.control.arabicName.errors.required)),n(),p("ngIf",i.control.arabicName.touched&&(i.control.arabicName.errors==null?null:i.control.arabicName.errors.maxlength)),n(3),C(c(28,36,"FIELDS.ENGLISH_NAME")),n(2),p("placeholder",c(30,38,"FIELDS.ENGLISH_NAME")),n(2),p("ngIf",i.control.englishName.touched&&(i.control.englishName.errors==null?null:i.control.englishName.errors.required)),n(),p("ngIf",i.control.englishName.touched&&(i.control.englishName.errors==null?null:i.control.englishName.errors.maxlength)),n(2),p("ngIf",!(!(i.data==null||i.data.response==null||i.data.response.icon==null)&&i.data.response.icon.blobUrI)),n(),p("ngIf",i.data==null||i.data.response==null||i.data.response.icon==null?null:i.data.response.icon.blobUrI),n(),p("ngIf",i.subCatagory.length==0),n(),p("ngIf",i.subCatagory.length>0),n(3),p("label",c(41,40,"GENERAL.CANCEL")),n(2),p("label",i.data!=null&&i.data.response?c(43,42,"GENERAL.UPDATE"):c(44,44,"GENERAL.SAVE"))("disabled",i.dialogForm.invalid))},dependencies:[L,fe,le,Q,q,W,Ne,Ae,ae,Ri,ee,re,_e,x,w,Te,We,z,Z,J,H,te,Gi,X,Ze,wi],styles:[".container-img[_ngcontent-%COMP%]{width:160px;height:124px;border:2px solid #ff7f3e;border-radius:8px;overflow:hidden;position:relative}.container-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}.container-img[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{position:absolute;top:4px;inset-inline-end:4px;cursor:pointer;height:20px;width:20px;background:#ff7f3e;padding:5px;border-radius:50%}.table-container[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto;display:block}.p-table[_ngcontent-%COMP%]{width:100%}.p-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;background:#f9f9f9;z-index:2}"]})}return t})();var ai={columns:[{field:"name",header:"CATEGORY_NAME",type:"label",exported:!1},{field:"subCategories",header:"SUB_CATAGORY",type:"label",exported:!0},{field:"classification",header:"CLASSIFICATION",type:"label",exported:!0},{field:"actions",header:"ACTIONS",type:"actions",exported:!1}],rowsPerPage:10,rowsPerPageOptions:[5,10,15,20,25,50,100],selectionMode:"single",actions:["CREATE"],rowsActions:["EDIT","DELETE"],paginator:!0,locale:"FIELDS.",dataLoading:"server"};var ni=t=>({fieldName:t}),Ci=()=>({maxLength:50});function At(t,u){if(t&1&&(s(0,"div",21)(1,"div"),d(2),r()()),t&2){let e=u.$implicit;n(2),C(e.name)}}function Nt(t,u){if(t&1&&(s(0,"div",21)(1,"div"),d(2),r()()),t&2){let e=u.$implicit;n(2),C(e.name)}}function Tt(t,u){if(t&1&&(s(0,"div",13)(1,"label",17),d(2),o(3,"translate"),r(),s(4,"p-dropdown",18),o(5,"translate"),E(6,At,3,1,"ng-template",19)(7,Nt,3,1,"ng-template",20),r()()),t&2){let e=N();n(2),C(c(3,5,"FIELDS.PARENT_CATEGORY")),n(2),p("options",e.data.categories)("filter",!0)("showClear",!0)("placeholder",c(5,7,"FIELDS.PARENT_CATEGORY"))}}function yt(t,u){t&1&&(s(0,"div",22),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,ni,c(2,1,"FIELDS.CLASSIFICATION")))," "))}function Dt(t,u){t&1&&(s(0,"div",22),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,ni,c(2,1,"FIELDS.BAR_CODE_NO")))," "))}function Ft(t,u){t&1&&(s(0,"div",22),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,Ci))," "))}function Lt(t,u){t&1&&(s(0,"div",22),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,ni,c(2,1,"FIELDS.SHORT_ARABIC_NAME")))," "))}function Bt(t,u){t&1&&(s(0,"div",22),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,Ci))," "))}function xt(t,u){t&1&&(s(0,"div",22),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,ni,c(2,1,"FIELDS.ENGLISH_NAME")))," "))}function Rt(t,u){t&1&&(s(0,"div",22),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,Ci))," "))}function Vt(t,u){if(t&1){let e=j();Ve(0),s(1,"p-fileUpload",23),o(2,"translate"),h("onSelect",function(i){M(e);let l=N();return U(l.onFileSelect(i))}),r(),we()}t&2&&(n(),p("chooseLabel",c(2,1,"GENERAL.CHOOSE")))}function wt(t,u){if(t&1){let e=j();Ve(0),s(1,"div",24),I(2,"img",25),s(3,"img",26),h("click",function(){M(e);let i=N();return U(i.removeImage())}),r()(),we()}if(t&2){let e=N();n(2),p("src",e.data.selectedSubCategory==null||e.data.selectedSubCategory.icon==null?null:e.data.selectedSubCategory.icon.blobUrI,be)("alt",e.data.parentId)}}var Hi=(()=>{class t{_fb;_popup;_translate;_toastr;_product;destroy$=new R;classifications=[];categories=[];data;dialogForm;constructor(e,a,i,l,m){this._fb=e,this._popup=a,this._translate=i,this._toastr=l,this._product=m}ngOnInit(){this.data=this._popup.getData(),this.prepareForm(),this.classifications=this.data?.classifications,console.log("this.data?.response",this.data),this.data?.response&&(this.dialogForm.patchValue(this.data?.response),this.setPreSelectedValues(),this.getAllCategories())}prepareForm(){this.dialogForm=this._fb.group({arabicName:[null,[v.required,v.maxLength(50)]],englishName:[null,[v.required,v.maxLength(50)]],classificationsIds:[null],classifications:[null,v.required],parentId:[this.data?.id],id:[this.data?.response?this.data.response.id:null],barcodeNumber:[null,v.required],icon:this._fb.group({externalStorageId:"",mimeType:"",sizeInBytes:0,blobUrI:""})})}get control(){return this.dialogForm.controls}subCatagory;getAllCategories(){this._product.getAllCategories(1e5,1,"").subscribe(e=>{let a=e.data.result,i=this.data?.response?.id,l=a.filter(m=>m.id==i);l&&(this.subCatagory=l[0]?.subCategories?l[0]?.subCategories:[])})}onClassificationChange(e){let a=e.value.map(i=>i.id);this.dialogForm.get("classificationsIds")?.setValue(a),this.dialogForm.get("classifications")?.setValue(e.value)}setPreSelectedValues(){let e=this.data?.response?.classifications.map(i=>this.classifications.find(l=>l.id===i.id)),a=e?.map(i=>i?.id);this.dialogForm.get("classificationsIds")?.setValue(a),this.dialogForm.patchValue({classifications:e})}save(){this.dialogForm.get("id")?.value||this.dialogForm.removeControl("id");let e=this.dialogForm.getRawValue();(this.data?.response?this._product.editCategory(e):this._product.addCategory(e)).pipe(b(this.destroy$)).subscribe(()=>this.afterSavingDone(this.data?.response?"edit":"add",e))}afterSavingDone(e,a){let i=this._translate.currentLang==="ar"?a?.arabicName:a?.englishName;this._translate.get(e=="add"?"GENERAL.ADDED_SUCCESSFULLY":"GENERAL.UPDATED_SUCCESSFULLY",{name:i}).subscribe(l=>this._toastr.success(l)),this._popup.close(!0)}removeImage(){this.data?.response&&this.data?.response?.icon&&(this.data.response.icon.blobUrI=null)}onFileSelect(e){if(e.files&&e.files[0]){let a=e.files[0];this.uploadImage(a).subscribe(i=>{this.updateFormWithResponse(i.data)},i=>{console.error("Error during image upload:",i)})}}uploadImage(e){let a=new FormData;return a.append("file",e),this._product.uploadGalaryImage(a)}updateFormWithResponse(e){this.dialogForm.get("icon")?.setValue({externalStorageId:e.externalStorageId,mimeType:e.mimeType,sizeInBytes:e.sizeInBytes,blobUrI:e.blobUrI})}onActionClicked(e){this._popup.close(e)}close=()=>this._popup.close();static \u0275fac=function(a){return new(a||t)(f(K),f(P),f(V),f(G),f(ce))};static \u0275cmp=D({type:t,selectors:[["admin-add-edit-subcategory"]],standalone:!0,features:[F],decls:41,vars:42,consts:[[1,"form-content",3,"formGroup"],[1,"row"],["class","col-12",4,"ngIf"],[1,"col-6"],["for","classification",1,"mb-2","block"],["formControlName","classifications","optionLabel","name",3,"onChange","options","placeholder"],["class","error-message",4,"ngIf"],["for","barcodeNumber",1,"mb-2","block"],["mode","decimal","inputId","withoutgrouping","formControlName","barcodeNumber",1,"w-full",3,"useGrouping","placeholder"],["for","arabicName",1,"mb-2","block"],["type","text","pInputText","","formControlName","arabicName",1,"w-full",3,"placeholder"],["for","englishName",1,"mb-2","block"],["type","text","pInputText","","formControlName","englishName",1,"w-full",3,"placeholder"],[1,"col-12"],[4,"ngIf"],[1,"col-3"],[1,"p-element","btn-tasheel","btn-primary","w-full",3,"onClick","label"],["for","parentCategory",1,"mb-2","block"],["formControlName","parentId","optionLabel","name","optionValue","id","filterBy","name",3,"options","filter","showClear","placeholder"],["pTemplate","selectedItem"],["pTemplate","item"],[1,"flex","align-items-center","gap-2"],[1,"error-message"],["mode","basic","chooseIcon","pi pi-upload","name","demo[]","accept","image/*","maxFileSize","1000000",3,"onSelect","chooseLabel"],[1,"container-img"],[3,"src","alt"],["src","assets/layout/images/close-icon.svg","alt","close-icon",1,"close",3,"click"]],template:function(a,i){a&1&&(s(0,"div",0)(1,"div",1),E(2,Tt,8,9,"div",2),s(3,"div",3)(4,"label",4),d(5),o(6,"translate"),r(),s(7,"p-multiSelect",5),o(8,"translate"),h("onChange",function(m){return i.onClassificationChange(m)}),r(),E(9,yt,4,8,"div",6),r(),s(10,"div",3)(11,"label",7),d(12),o(13,"translate"),r(),I(14,"p-inputNumber",8),o(15,"translate"),E(16,Dt,4,8,"div",6)(17,Ft,3,5,"div",6),r(),s(18,"div",3)(19,"label",9),d(20),o(21,"translate"),r(),I(22,"input",10),o(23,"translate"),E(24,Lt,4,8,"div",6)(25,Bt,3,5,"div",6),r(),s(26,"div",3)(27,"label",11),d(28),o(29,"translate"),r(),I(30,"input",12),o(31,"translate"),E(32,xt,4,8,"div",6)(33,Rt,3,5,"div",6),r(),s(34,"div",13),E(35,Vt,3,3,"ng-container",14)(36,wt,4,2,"ng-container",14),r(),s(37,"div",15)(38,"p-button",16),o(39,"translate"),o(40,"translate"),h("onClick",function(){return i.save()}),r()()()()),a&2&&(p("formGroup",i.dialogForm),n(2),p("ngIf",(i.data==null||i.data.categories==null?null:i.data.categories.length)>0),n(3),C(c(6,22,"FIELDS.CLASSIFICATION")),n(2),p("options",i.classifications)("placeholder",c(8,24,"FIELDS.CLASSIFICATION")),n(2),p("ngIf",i.control.classifications.touched&&(i.control.classifications.errors==null?null:i.control.classifications.errors.required)),n(3),C(c(13,26,"FIELDS.BAR_CODE_NO")),n(2),p("useGrouping",!1)("placeholder",c(15,28,"FIELDS.BAR_CODE_NO")),n(2),p("ngIf",i.control.barcodeNumber.touched&&(i.control.barcodeNumber.errors==null?null:i.control.barcodeNumber.errors.required)),n(),p("ngIf",i.control.barcodeNumber.touched&&(i.control.barcodeNumber.errors==null?null:i.control.barcodeNumber.errors.maxlength)),n(3),C(c(21,30,"FIELDS.SHORT_ARABIC_NAME")),n(2),p("placeholder",c(23,32,"FIELDS.SHORT_ARABIC_NAME")),n(2),p("ngIf",i.control.arabicName.touched&&(i.control.arabicName.errors==null?null:i.control.arabicName.errors.required)),n(),p("ngIf",i.control.arabicName.touched&&(i.control.arabicName.errors==null?null:i.control.arabicName.errors.maxlength)),n(3),C(c(29,34,"FIELDS.ENGLISH_NAME")),n(2),p("placeholder",c(31,36,"FIELDS.ENGLISH_NAME")),n(2),p("ngIf",i.control.englishName.touched&&(i.control.englishName.errors==null?null:i.control.englishName.errors.required)),n(),p("ngIf",i.control.englishName.touched&&(i.control.englishName.errors==null?null:i.control.englishName.errors.maxlength)),n(2),p("ngIf",!(!(i.data==null||i.data.selectedSubCategory==null||i.data.selectedSubCategory.icon==null)&&i.data.selectedSubCategory.icon.blobUrI)),n(),p("ngIf",i.data==null||i.data.selectedSubCategory==null||i.data.selectedSubCategory.icon==null?null:i.data.selectedSubCategory.icon.blobUrI),n(2),p("label",i.data?c(39,38,"GENERAL.UPDATE"):c(40,40,"GENERAL.SAVE")))},dependencies:[L,fe,le,Q,q,W,Ne,Ae,ae,ee,re,_e,x,w,Te,We,Vi,z,Z,J,H,te,X,$,ie,Ze]})}return t})();function Mt(t,u){if(t&1&&(s(0,"div",7)(1,"div"),d(2),r()()),t&2){let e=u.$implicit;n(2),C(e.name)}}var vr=(()=>{class t{_confirm;_product;_popup;_translate;_unsubscribeAll=new R;classifications=[];tableConfig;displayDialog=!1;selectedClassification=null;pageSize=10;pageNumber=1;totalRecords=0;first=0;keyword="";searchControl=new he;constructor(e,a,i,l){this._confirm=e,this._product=a,this._popup=i,this._translate=l}ngOnInit(){this.tableConfig=ai,this.getAllCategories(),this.getClassifications(),this.onSearch()}getClassifications(){this._product.getClassifications().pipe(b(this._unsubscribeAll)).subscribe(e=>{this.classifications=e?.data?.classifications})}onActionClicked(e){switch(e.action){case"CREATE":this.openCreateDialog();break;case"EDIT":this.getCategoryById(e.data);break;case"DELETE":this.onActionDelete(e.data);break}}onActionDelete(e){this._confirm.confirm("delete").subscribe(a=>{a&&this._product.deleteCategory(e.id).pipe(b(this._unsubscribeAll)).subscribe(i=>{i.data&&this.getAllCategories()})})}onClassificationChange(e){this.selectedClassification=e.value,this.filterCategories()}getAllCategories(){this._product.getAllCategories(this.pageSize,this.pageNumber,this.keyword).pipe(b(this._unsubscribeAll)).subscribe(e=>{this.tableConfig=y(T({},ai),{rows:e.data.result.map(a=>y(T({},a),{classification:a?.classification.map(i=>i.name).join(", "),subCategories:a?.subCategories.map(i=>i.name).join(", ")}))||[],totalRecords:e.data.rowCount,rowsActions:["EDIT","DELETE"]})})}filterCategories(){this.selectedClassification?this._product.getAllCategories(this.pageSize,this.pageNumber,this.keyword).pipe(b(this._unsubscribeAll)).subscribe(e=>{let a=e.data.result.filter(i=>Array.isArray(i.classification)?i.classification.some(l=>l.id===this.selectedClassification?.id):i.classification?.id===this.selectedClassification?.id);this.tableConfig.rows=a.map(i=>y(T({},i),{classification:Array.isArray(i.classification)?i.classification.map(l=>l.name).join(", "):i.classification?.name,subCategories:i.subCategories.map(l=>l.name).join(", ")}))}):this.getAllCategories()}onPageChange(e){this.first=e.first||0,this.pageSize=e.rows||10,this.pageNumber=e.page||1,this.getAllCategories()}onDialogClose(){this.displayDialog=!1}onSearch(){this.searchControl.valueChanges.pipe(Be(e=>e.trim().length>=0),xe(400),Re(e=>this._product.getAllCategories(this.pageSize,this.pageNumber,e.trim()))).subscribe(e=>{e&&e.data&&(this.tableConfig=y(T({},ai),{rows:e.data.result.map(a=>y(T({},a),{classification:a.classification.map(i=>i.name).join(", "),subCategories:a.subCategories.map(i=>i.name).join(", ")}))||[],totalRecords:e.data.rowCount,rowsActions:["EDIT","DELETE"]}))})}openCreateDialog(){this._popup.open(Ei,{title:this._translate.instant("CATEGORY.ADD_NEW_CATEGORY"),position:this._translate.currentLang==="ar"?"left":"right",data:{classifications:this.classifications}}).afterClosed.subscribe(e=>e&&this.getAllCategories())}id;getCategoryById(e){this.id=e.id,this._product.getCategoryById(Number(e.id)).subscribe(a=>{a.data&&this._popup.open(Ei,{title:this._translate.instant("CATEGORY.EDIT_NEW_CATEGORY"),position:this._translate.currentLang==="ar"?"left":"right",data:{response:a.data,classifications:this.classifications}}).afterClosed.subscribe(i=>{i?.action=="EDIT_SUB_CATEGORY"?this.openSubCategoryDialog(i?.data?.data):i?.action=="ADD_SUB_CATEGORY"&&this.openSubCategoryDialog(),this.getAllCategories()})})}openSubCategoryDialog(e){this._popup.open(Hi,{title:this._translate.instant("CATEGORY.EDIT_NEW_CATEGORY"),position:this._translate.currentLang==="ar"?"left":"right",data:{response:e,id:this.id,categories:this.tableConfig.rows,classifications:this.classifications}}).afterClosed.subscribe(a=>{a&&this.getAllCategories()})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}static \u0275fac=function(a){return new(a||t)(f(ne),f(ce),f(P),f(V))};static \u0275cmp=D({type:t,selectors:[["admin-categories"]],standalone:!0,features:[F],decls:10,vars:7,consts:[[1,"dialog-side"],[3,"actionClicked","onPage","onSearch","config"],["filters-area","",1,"filters","row"],[1,"filters-item","col-2","p-0"],[1,"filters-actions","col-4","p-0"],["formControlName","classification","optionLabel","name","filterBy","name",1,"w-full",3,"onChange","options","filter","showClear","placeholder"],["pTemplate","selectedItem"],[1,"flex","align-items-center","gap-2"]],template:function(a,i){a&1&&(s(0,"section",0)(1,"shared-ui-table",1),h("actionClicked",function(m){return i.onActionClicked(m)})("onPage",function(m){return i.onPageChange(m)})("onSearch",function(m){return i.searchControl.patchValue(m)}),s(2,"div",2)(3,"div",3),d(4,"Filters"),r(),s(5,"div",4),d(6,"` "),s(7,"p-dropdown",5),o(8,"translate"),h("onChange",function(m){return i.onClassificationChange(m)}),E(9,Mt,3,1,"ng-template",6),r()()()()()),a&2&&(n(),p("config",i.tableConfig),n(6),p("options",i.classifications)("filter",!0)("showClear",!0)("placeholder",c(8,5,"FIELDS.CLASSIFICATION")))},dependencies:[L,oe,$,ie,ae,pe,x,w],encapsulation:2})}return t})();var qi={columns:[{field:"arabicName",header:"VARIANTNAME",type:"label",exported:!1},{field:"variantsValueProp",header:"VARIANTVALUE",type:"label",exported:!1},{field:"classification",header:"CLASSIFICATION",type:"label",exported:!1},{field:"actions",header:"ACTIONS",type:"actions",exported:!1}],rowsPerPage:10,rowsPerPageOptions:[5,10,15,20,25,50,100],selectionMode:"single",actions:["CREATE"],rowsActions:["EDIT","DELETE","ADD_VARIANT_VALUE"],paginator:!0,locale:"FIELDS.",dataLoading:"server",hasFilters:!0};var Oe=(()=>{class t{_http;constructor(e){this._http=e}getAll(e){return this._http.get(`${B.URL_API}Variants/name`,e)}getById(e){return this._http.get(`${B.URL_API}Variants/${e}/Details`)}update(e){return this._http.put(`${B.URL_API}Variants`,e)}create(e){return this._http.post(`${B.URL_API}Variants`,e)}delete(e){return this._http.delete(`${B.URL_API}Variants/${e}`)}addValues(e){return this._http.post(`${B.URL_API}Variants/variantValues`,e)}static \u0275fac=function(a){return new(a||t)(ve(Ie))};static \u0275prov=Ce({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var je=t=>({fieldName:t}),ri=()=>({maxLength:50});function Ut(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,je,c(2,1,"FIELDS.CLASSIFICATION")))," "))}function Gt(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,je,c(2,1,"FIELDS.ARABIC_NAME")))," "))}function Pt(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,ri))," "))}function kt(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,je,c(2,1,"FIELDS.ENGLISH_NAME")))," "))}function Ot(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,ri))," "))}function jt(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,je,c(2,1,"FIELDS.ARABIC_NAME")))," "))}function $t(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,ri))," "))}function Ht(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,je,c(2,1,"FIELDS.ENGLISH_NAME")))," "))}function qt(t,u){t&1&&(s(0,"div",18),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,ri))," "))}function zt(t,u){if(t&1){let e=j();s(0,"div",19)(1,"div",6)(2,"div",20)(3,"div",21)(4,"div",8)(5,"label",9),d(6),o(7,"translate"),r(),I(8,"input",22),o(9,"translate"),E(10,jt,4,8,"div",5)(11,$t,3,5,"div",5),r()(),s(12,"div",23)(13,"div",8)(14,"label",9),d(15),o(16,"translate"),r(),I(17,"input",24),o(18,"translate"),E(19,Ht,4,8,"div",5)(20,qt,3,5,"div",5),r()(),s(21,"div",25)(22,"div",15)(23,"p-button",26),h("click",function(){M(e);let i=N();return U(i.addNewVariants())}),r(),s(24,"p-button",27),h("click",function(){let i=M(e).index,l=N();return U(l.removeVariants(i))}),r()()()()()()}if(t&2){let e,a,i,l,m=u.index,k=N();p("formGroupName",m),n(6),C(c(7,13,"FIELDS.ARABIC_NAME")),n(2),Me("id","arabicName",m,""),p("placeholder",c(9,15,"FIELDS.ARABIC_NAME")),n(2),p("ngIf",((e=k.variantValues.at(m).get("arabicName"))==null?null:e.touched)&&((e=k.variantValues.at(m).get("arabicName"))==null?null:e.hasError("required"))),n(),p("ngIf",((a=k.variantValues.at(m).get("arabicName"))==null?null:a.touched)&&((a=k.variantValues.at(m).get("arabicName"))==null?null:a.hasError("maxlength"))),n(4),C(c(16,17,"FIELDS.ENGLISH_NAME")),n(2),Me("id","englishName",m,""),p("placeholder",c(18,19,"FIELDS.ENGLISH_NAME")),n(2),p("ngIf",((i=k.variantValues.at(m).get("englishName"))==null?null:i.touched)&&((i=k.variantValues.at(m).get("englishName"))==null?null:i.hasError("required"))),n(),p("ngIf",((l=k.variantValues.at(m).get("englishName"))==null?null:l.touched)&&((l=k.variantValues.at(m).get("englishName"))==null?null:l.hasError("maxlength")))}}var vi=(()=>{class t{fb;_popup;_varaints;_translate;_toastr;_product;destroy$=new R;addVariantForm;classifications=[];breadcrumb;variantsData;constructor(e,a,i,l,m,k){this.fb=e,this._popup=a,this._varaints=i,this._translate=l,this._toastr=m,this._product=k}ngOnInit(){this.initForm(),this.getClassifications(),this.variantsData=this._popup.getData(),this.variantsData.id&&this.getVariantsDataDetails()}getClassifications(){this._product.getClassifications().pipe(b(this.destroy$)).subscribe(e=>{this.classifications=e.data.classifications})}getVariantsDataDetails(){this._varaints.getById(this.variantsData.id).pipe(b(this.destroy$)).subscribe(e=>{this.variantsData=e.data,this.variantsData.id&&this.setdataInform()})}initForm(){this.addVariantForm=this.fb.group({id:[0],arabicName:["",[v.required,v.maxLength(50)]],englishName:["",[v.required,v.maxLength(50)]],classificationIds:[[],v.required],variantValues:this.fb.array([this.createVariantGroup()])})}setdataInform(){if(this.variantsData){this.addVariantForm.patchValue(this.variantsData),this.variantValues.clear();for(let e=0;e<this.variantsData.variantValues.length;e++)this.variantValues.push(this.fb.group({id:this.variantsData.variantValues[e].id,englishName:this.variantsData.variantValues[e].englishName,arabicName:this.variantsData.variantValues[e].arabicName}))}}onClassificationChange(e){this.addVariantForm.get("classificationId")?.setValue(e.value.id),this.addVariantForm.get("classification")?.setValue(e.value)}get variantValues(){return this.addVariantForm.get("variantValues")}get control(){return this.addVariantForm.controls}createVariantGroup(){return this.fb.group({id:[0],arabicName:["",[v.required,v.maxLength(50)]],englishName:["",[v.required,v.maxLength(50)]]})}addNewVariants(){this.variantValues.push(this.createVariantGroup())}removeVariants(e){e&&this.variantValues.removeAt(e)}save(){let e=this.addVariantForm.getRawValue();(e.id?this._varaints.update(e):this._varaints.create(e)).pipe(b(this.destroy$)).subscribe(()=>this.afterSavingDone(e.id?"edit":"add",e))}afterSavingDone(e,a){let i=this._translate.currentLang==="ar"?a?.arabicName:a?.englishName;this._translate.get(e?"GENERAL.ADDED_SUCCESSFULLY":"UPDATED_SUCCESSFULLY",{name:i}).subscribe(l=>this._toastr.success(l)),this._popup.close(!0)}close=()=>this._popup.close();ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(a){return new(a||t)(f(K),f(P),f(Oe),f(V),f(G),f(ce))};static \u0275cmp=D({type:t,selectors:[["admin-add-edit-variants"]],standalone:!0,features:[F],decls:36,vars:37,consts:[[1,"p-fluid","formgrid",3,"formGroup"],[1,"p-grid","mb-1"],[1,"p-col-6"],["for","classificationIds"],["formControlName","classificationIds","optionLabel","name","optionValue","id","filterBy","name",3,"onChange","options","filter","showClear","placeholder"],["class","error-message",4,"ngIf"],[1,"grid"],[1,"field","col-6"],[1,"flex","flex-column","gap-2"],["for","arabicName"],["pInputText","","formControlName","arabicName","id","arabicName","aria-describedby","arabicName-help",3,"placeholder"],["for","englishName"],["pInputText","","formControlName","englishName","id","englishName","aria-describedby","englishName-help",3,"placeholder"],["formArrayName","variantValues"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"flex","gap-2","align-items-center","justify-content-end"],["severity","danger",3,"onClick","label"],["severity","primary",3,"onClick","disabled","label"],[1,"error-message"],[3,"formGroupName"],[1,"flex","align-items-center"],[1,"field","col-5"],["pInputText","","formControlName","arabicName","aria-describedby","arabicName-help",3,"placeholder","id"],[1,"field","md:col-5"],["pInputText","","formControlName","englishName","aria-describedby","englishName-help",3,"placeholder","id"],[1,"field","col-2"],["severity","primary","icon","pi pi-plus",3,"click"],["severity","danger","icon","pi pi-minus",3,"click"]],template:function(a,i){a&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),d(4),o(5,"translate"),r(),s(6,"p-multiSelect",4),o(7,"translate"),h("onChange",function(m){return i.onClassificationChange(m)}),r(),E(8,Ut,4,8,"div",5),r()(),s(9,"div",6)(10,"div",7)(11,"div",8)(12,"label",9),d(13),o(14,"translate"),r(),I(15,"input",10),o(16,"translate"),E(17,Gt,4,8,"div",5)(18,Pt,3,5,"div",5),r()(),s(19,"div",7)(20,"div",8)(21,"label",11),d(22),o(23,"translate"),r(),I(24,"input",12),o(25,"translate"),E(26,kt,4,8,"div",5)(27,Ot,3,5,"div",5),r()()(),s(28,"div",13),E(29,zt,25,21,"div",14),r(),s(30,"div",15)(31,"p-button",16),o(32,"translate"),h("onClick",function(){return i.close()}),r(),s(33,"p-button",17),o(34,"translate"),o(35,"translate"),h("onClick",function(){return i.save()}),r()()()),a&2&&(p("formGroup",i.addVariantForm),n(4),C(c(5,19,"FIELDS.CLASSIFICATION")),n(2),p("options",i.classifications)("filter",!0)("showClear",!0)("placeholder",c(7,21,"FIELDS.CLASSIFICATION")),n(2),p("ngIf",i.control.classificationIds.touched&&(i.control.classificationIds.errors==null?null:i.control.classificationIds.errors.required)),n(5),C(c(14,23,"FIELDS.ARABIC_NAME")),n(2),p("placeholder",c(16,25,"FIELDS.ARABIC_NAME")),n(2),p("ngIf",i.control.arabicName.touched&&(i.control.arabicName.errors==null?null:i.control.arabicName.errors.required)),n(),p("ngIf",i.control.arabicName.touched&&(i.control.arabicName.errors==null?null:i.control.arabicName.errors.maxlength)),n(4),C(c(23,27,"FIELDS.ENGLISH_NAME")),n(2),p("placeholder",c(25,29,"FIELDS.ENGLISH_NAME")),n(2),p("ngIf",i.control.englishName.touched&&(i.control.englishName.errors==null?null:i.control.englishName.errors.required)),n(),p("ngIf",i.control.englishName.touched&&(i.control.englishName.errors==null?null:i.control.englishName.errors.maxlength)),n(2),p("ngForOf",i.variantValues.controls),n(2),p("label",c(32,31,"GENERAL.CANCEL")),n(2),p("disabled",i.addVariantForm.invalid)("label",i.variantsData.id?c(34,33,"GENERAL.UPDATE"):c(35,35,"GENERAL.SAVE")))},dependencies:[L,Xe,fe,le,Q,q,W,z,Z,J,Ye,Qe,H,te,X,ee,x,w,re,_e,Te]})}return t})();var Xi=t=>({fieldName:t}),Yi=()=>({maxLength:50});function Xt(t,u){t&1&&(s(0,"div",20),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,Xi,c(2,1,"FIELDS.ARABIC_NAME")))," "))}function Yt(t,u){t&1&&(s(0,"div",20),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,Yi))," "))}function Qt(t,u){t&1&&(s(0,"div",20),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,Xi,c(2,1,"FIELDS.ENGLISH_NAME")))," "))}function Wt(t,u){t&1&&(s(0,"div",20),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,Yi))," "))}function Zt(t,u){if(t&1){let e=j();s(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9)(4,"div",10)(5,"label",11),d(6),o(7,"translate"),r(),I(8,"input",12),o(9,"translate"),E(10,Xt,4,8,"div",13)(11,Yt,3,5,"div",13),r()(),s(12,"div",14)(13,"div",10)(14,"label",11),d(15),o(16,"translate"),r(),I(17,"input",15),o(18,"translate"),E(19,Qt,4,8,"div",13)(20,Wt,3,5,"div",13),r()(),s(21,"div",16)(22,"div",17)(23,"p-button",18),h("click",function(){M(e);let i=N();return U(i.addNewVariants())}),r(),s(24,"p-button",19),h("click",function(){let i=M(e).index,l=N();return U(l.removeVariants(i))}),r()()()()()()}if(t&2){let e,a,i,l,m=u.index,k=N();p("formGroupName",m),n(6),C(c(7,13,"FIELDS.ARABIC_NAME")),n(2),Me("id","arabicName",m,""),p("placeholder",c(9,15,"FIELDS.ARABIC_NAME")),n(2),p("ngIf",((e=k.variantValues.at(m).get("arabicName"))==null?null:e.touched)&&((e=k.variantValues.at(m).get("arabicName"))==null?null:e.hasError("required"))),n(),p("ngIf",((a=k.variantValues.at(m).get("arabicName"))==null?null:a.touched)&&((a=k.variantValues.at(m).get("arabicName"))==null?null:a.hasError("maxlength"))),n(4),C(c(16,17,"FIELDS.ENGLISH_NAME")),n(2),Me("id","englishName",m,""),p("placeholder",c(18,19,"FIELDS.ENGLISH_NAME")),n(2),p("ngIf",((i=k.variantValues.at(m).get("englishName"))==null?null:i.touched)&&((i=k.variantValues.at(m).get("englishName"))==null?null:i.hasError("required"))),n(),p("ngIf",((l=k.variantValues.at(m).get("englishName"))==null?null:l.touched)&&((l=k.variantValues.at(m).get("englishName"))==null?null:l.hasError("maxlength")))}}var Qi=(()=>{class t{fb;_popup;_variants;_translate;_toastr;addVariantValueForm;destroy$=new R;variantsData;constructor(e,a,i,l,m){this.fb=e,this._popup=a,this._variants=i,this._translate=l,this._toastr=m}ngOnInit(){this.initForm(),this.variantsData=this._popup.getData()}initForm(){this.addVariantValueForm=this.fb.group({id:[0],variantValues:this.fb.array([this.createVariantGroup()])})}addNewVariants(){this.variantValues.push(this.createVariantGroup())}removeVariants(e){e&&this.variantValues.removeAt(e)}get variantValues(){return this.addVariantValueForm.get("variantValues")}createVariantGroup(){return this.fb.group({id:[0],arabicName:["",[v.required,v.maxLength(50)]],englishName:["",[v.required,v.maxLength(50)]]})}get control(){return this.addVariantValueForm.controls}save(){let e=this.addVariantValueForm.getRawValue();e.id=this.variantsData?.id,e.classificationIds&&(e.classificationIds=e.classificationIds.map(a=>a.id?a.id:a)),this._variants.create(e).pipe(b(this.destroy$)).subscribe(()=>this.afterSavingDone(this.variantsData))}afterSavingDone(e){let a=this._translate.currentLang==="ar"?e?.arabicName:e?.englishName;this._translate.get("GENERAL.ADDED_SUCCESSFULLY",{name:a}).subscribe(i=>this._toastr.success(i)),this._popup.close(!0)}close=()=>this._popup.close();ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(a){return new(a||t)(f(K),f(P),f(Oe),f(V),f(G))};static \u0275cmp=D({type:t,selectors:[["admin-add-variants-value"]],standalone:!0,features:[F],decls:8,vars:9,consts:[[1,"p-fluid","formgrid",3,"formGroup"],["formArrayName","variantValues"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"flex","gap-2","align-items-center","justify-content-end"],["severity","danger",3,"onClick","label"],["severity","primary",3,"onClick","disabled","label"],[3,"formGroupName"],[1,"grid"],[1,"flex","align-items-center"],[1,"field","col-5"],[1,"flex","flex-column","gap-2"],["for","arabicName"],["pInputText","","formControlName","arabicName","aria-describedby","arabicName-help",3,"placeholder","id"],["class","error-message",4,"ngIf"],[1,"field","md:col-5"],["pInputText","","type","text","formControlName","englishName",3,"id","placeholder"],[1,"field","col-2"],[1,"flex","gap-2","mt-1","align-items-center","justify-content-end"],["severity","primary","icon","pi pi-plus",3,"click"],["severity","danger","icon","pi pi-minus",3,"click"],[1,"error-message"]],template:function(a,i){a&1&&(s(0,"div",0)(1,"div",1),E(2,Zt,25,21,"div",2),r(),s(3,"div",3)(4,"p-button",4),o(5,"translate"),h("onClick",function(){return i.close()}),r(),s(6,"p-button",5),o(7,"translate"),h("onClick",function(){return i.save()}),r()()()),a&2&&(p("formGroup",i.addVariantValueForm),n(2),p("ngForOf",i.variantValues.controls),n(2),p("label",c(5,5,"GENERAL.CANCEL")),n(2),p("disabled",i.addVariantValueForm.invalid)("label",c(7,7,"GENERAL.SAVE")))},dependencies:[L,Xe,fe,le,Q,q,W,z,Z,J,Ye,Qe,X,ee,x,w,H,te]})}return t})();var ea=()=>[],Io=(()=>{class t{_confirm;_product;_variants;_popup;_toastr;_translate;destroy$=new R;classifications$;tableConfig$;searchControl=new he;filters={PageNumber:1,PageSize:10,name:"",classification:null};constructor(e,a,i,l,m,k){this._confirm=e,this._product=a,this._variants=i,this._popup=l,this._toastr=m,this._translate=k}ngOnInit(){this.getClassifications(),this.getAllVariants(this.filters),this.onSearchData()}getClassifications(){this.classifications$=this._product.getClassifications().pipe(ge(e=>e.data.classifications))}onSearchData(){this.searchControl.valueChanges.pipe(Be(e=>e.trim().length>0),xe(400),Re(e=>this._variants.getAll(this.filters=y(T({},this.filters),{name:e})))).subscribe(e=>{this.tableConfig$=Ee(this.mappedVariants(e))})}onPageChange(e){this.filters=y(T({},this.filters),{PageSize:e.rows||10,PageNumber:e.page||1}),this.getAllVariants(this.filters)}getAllVariants(e){this.tableConfig$=this._variants.getAll(e).pipe(ge(a=>this.mappedVariants(a)))}onActionClicked(e){switch(e.action){case"CREATE":this.createVariant();break;case"ADD_VARIANT_VALUE":e.data&&this.createVariantValues(e.data);break;case"DELETE":e.data&&this.deleteVariant(e.data);break;case"EDIT":e.data&&this.editVariant(e.data);break;default:break}}createVariant(){this._popup.open(vi,{title:this._translate.instant("VARIANTS.ADD_NEW_VARIANT"),position:this._translate.currentLang==="ar"?"left":"right"}).afterClosed.subscribe(e=>e&&this.getAllVariants(this.filters))}createVariantValues(e){this._popup.open(Qi,{title:this._translate.instant("VARIANTS.ADD_NEW_VARIANT"),position:this._translate.currentLang==="ar"?"left":"right",data:e}).afterClosed.subscribe(a=>a&&this.getAllVariants(this.filters))}editVariant(e){this._popup.open(vi,{title:this._translate.instant("VARIANTS.EDIT_VARIANT"),position:this._translate.currentLang==="ar"?"left":"right",data:e}).afterClosed.subscribe(a=>a&&this.getAllVariants(this.filters))}deleteVariant(e){this._confirm.confirm("delete").subscribe(a=>{a&&this._variants.delete(e.id).pipe(b(this.destroy$)).subscribe(i=>{i.data&&(this._toastr.success("Variant Deleted Successfully"),this.getAllVariants(this.filters))})})}mappedVariants(e){return console.log("API Response:",e),y(T({},qi),{totalRecords:e.data.rowCount,rowsPerPage:this.filters.PageSize,rows:e.data.result.map(a=>y(T({},a),{classification:a.classificationIds.map(i=>i.name).join(", "),variantsValueProp:a.variantValues.map(i=>i.name).join(", ")}))||[]})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(a){return new(a||t)(f(ne),f(ce),f(Oe),f(P),f(G),f(V))};static \u0275cmp=D({type:t,selectors:[["admin-variants"]],standalone:!0,features:[F],decls:9,vars:13,consts:[[3,"actionClicked","onPage","onSearch","config"],["filters-area","",1,"filters","p-grid"],[1,"filters-item","col-2","p-0"],[1,"filters-actions","col-4","p-0"],["optionLabel","name","filterBy","name","placeholder","Select a classifications",1,"w-full",3,"ngModelChange","onChange","options","ngModel","filter","showClear"]],template:function(a,i){a&1&&(s(0,"shared-ui-table",0),o(1,"async"),h("actionClicked",function(m){return i.onActionClicked(m)})("onPage",function(m){return i.onPageChange(m)})("onSearch",function(m){return i.searchControl.patchValue(m)}),s(2,"div",1)(3,"div",2),d(4),o(5,"translate"),r(),s(6,"div",3)(7,"p-dropdown",4),o(8,"async"),ze("ngModelChange",function(m){return qe(i.filters.classification,m)||(i.filters.classification=m),m}),h("onChange",function(){return i.getAllVariants(i.filters)}),r()()()()),a&2&&(p("config",c(1,6,i.tableConfig$)),n(4),C(c(5,8,"GENERAL.FILTERS")),n(3),p("options",c(8,10,i.classifications$)||A(12,ea)),He("ngModel",i.filters.classification),p("filter",!0)("showClear",!0))},dependencies:[L,Se,$,ie,pe,X,oe,x,w,le,q,xi,z],encapsulation:2})}return t})();var oi=(()=>{class t{_http;constructor(e){this._http=e}getClassifications(){return this._http.get(`${B.URL_API}Classifications`)}getBrands(e){return this._http.get(`${B.URL_API}Brands?PageSize=${e.size}&PageNumber=${e.number}`)}addBrand(e){return this._http.post(`${B.URL_API}Brands`,e)}deleteBrand(e){return this._http.delete(`${B.URL_API}Brands/${e}`)}editBrand(e){return this._http.put(`${B.URL_API}Brands`,e)}getBrandById(e){return this._http.get(`${B.URL_API}Brands/${e}`)}static \u0275fac=function(a){return new(a||t)(ve(Ie))};static \u0275prov=Ce({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Zi=t=>({"ng-dirty ng-invalid":t}),bi=t=>({fieldName:t}),Ji=()=>({maxLength:50});function ia(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,bi,c(2,1,"FIELDS.classificationIds")))," "))}function ta(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,bi,c(2,1,"FIELDS.ENGLISH_NAME")))," "))}function aa(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,Ji))," "))}function na(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,bi,c(2,1,"FIELDS.ARABIC_NAME")))," "))}function ra(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,Ji))," "))}function oa(t,u){if(t&1){let e=j();s(0,"div",11),I(1,"img",15),s(2,"img",16),h("click",function(){M(e);let i=N();return U(i.removeFile())}),r()()}if(t&2){let e=N();n(),p("src",e.brand.icon==null?null:e.brand.icon.blobUrI,be)("alt",e.brand.icon==null?null:e.brand.icon.id)}}function sa(t,u){if(t&1){let e=j();s(0,"label",17),d(1,"Brand Icon"),r(),s(2,"p-fileUpload",18),h("onSelect",function(i){M(e);let l=N();return U(l.uploadFile(i))}),r()}t&2&&(n(2),p("showUploadButton",!1)("showCancelButton",!1)("maxFileSize",1e6))}var Si=(()=>{class t{_product;_popup;_translate;_toastr;_fb;destroy$=new R;formError;brandForm;brand;selectedBrands;classifications=[];constructor(e,a,i,l,m){this._product=e,this._popup=a,this._translate=i,this._toastr=l,this._fb=m}ngOnInit(){this.brand=this._popup.getData(),this.brandForm=this.initForm(),this.formError=new Ge.ErrorManagement(this.brandForm),this.brand.id&&this.getBrandDetails(),this.getClassifications()}getBrandDetails(){this._product.getBrandById(this.brand.id).pipe(b(this.destroy$)).subscribe({next:e=>{this.brand=e.data,this.selectedBrands||(this.selectedBrands={classificationModels:[],classificationIds:[]}),this.selectedBrands.classificationIds=(this.brand.classificationModels||[]).map(a=>a.id||0),this.brand.id&&this.patchFormData()}})}initForm(){return this._fb.group({id:[0],classificationIds:[[],[v.required]],arabicName:["",[v.required]],englishName:["",[v.required]],serviceType:[null,[v.required]],icon:this._fb.group({id:0,externalStorageId:"",mimeType:"",has360View:!1,sizeInBytes:0,blobUrI:""})})}patchFormData(){this.brandForm.patchValue({id:this.brand.id,classificationIds:this.selectedBrands.classificationIds||[],arabicName:this.brand.arabicName,englishName:this.brand.englishName,icon:this.brand.icon||{}}),console.log("Form Value Inside patchFormData:",this.brandForm.value);let e=this.brandForm.get("icon");this.brand.icon&&e.patchValue({id:this.brand.icon.id,externalStorageId:this.brand.icon.externalStorageId,mimeType:this.brand.icon.mimeType,has360View:this.brand.icon.has360View,sizeInBytes:this.brand.icon.sizeInBytes,blobUrI:this.brand.icon.blobUrI})}uploadFile(e){let a=e.files;if(a.length>0){let i=a[0];this.brandForm.get("icon").patchValue({id:0,externalStorageId:i.name,mimeType:i.type,sizeInBytes:i.size,has360View:!0,blobUrl:URL.createObjectURL(i)})}}removeFile(){this.brandForm.get("icon")?.get("blobUrI")?.setValue(""),this.brand.icon&&(this.brand.icon.blobUrI=void 0)}save(){let e=this.brandForm.getRawValue();(e.id?this._product.editBrand(e):this._product.addBrand(e)).pipe(b(this.destroy$)).subscribe(()=>this.afterSavingDone(e.id?"edit":"add",e))}afterSavingDone(e,a){let i=this._translate.currentLang==="ar"?a?.arabicName:a?.englishName;this._translate.get(e?"GENERAL.ADDED_SUCCESSFULLY":"UPDATED_SUCCESSFULLY",{name:i}).subscribe(l=>this._toastr.success(l)),this._popup.close(!0)}close=()=>this._popup.close();onClassificationChange(e){this.brandForm.get("classificationId")?.setValue(e.value.id),this.brandForm.get("classification")?.setValue(e.value)}getClassifications(){this._product.getClassifications().pipe(b(this.destroy$)).subscribe({next:e=>{this.classifications=e.data.classifications}})}static \u0275fac=function(a){return new(a||t)(f(oi),f(P),f(V),f(G),f(K))};static \u0275cmp=D({type:t,selectors:[["admin-brands-form"]],standalone:!0,features:[F],decls:34,vars:42,consts:[["autocomplete","off",3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12"],["for","classificationIds"],["formControlName","classificationIds","optionLabel","name","optionValue","id","filterBy","name",3,"onChange","options","filter","showClear","placeholder"],["id","serviceType-error",1,"text-error"],[1,"field","col-12","md:col-6"],["for","englishName"],["pInputText","","type","text","pInputText","","formControlName","englishName",1,"w-full",3,"ngClass","placeholder"],["for","arabicName"],["type","text","pInputText","","formControlName","arabicName",1,"w-full",3,"ngClass","placeholder"],[1,"container-img"],[1,"flex","gap-2","align-items-center","justify-content-end"],["severity","danger",3,"onClick","label"],["severity","primary",3,"onClick","label"],[3,"src","alt"],["src","assets/layout/images/close-icon.svg","alt","close-icon",1,"close",3,"click"],["for","icon"],["name","icon","id","icon","accept","image/*",3,"onSelect","showUploadButton","showCancelButton","maxFileSize"]],template:function(a,i){a&1&&(s(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),d(4),o(5,"translate"),r(),s(6,"p-multiSelect",4),o(7,"translate"),h("onChange",function(m){return i.onClassificationChange(m)}),r(),E(8,ia,4,8,"small",5),r(),s(9,"div",6)(10,"label",7),d(11),o(12,"translate"),r(),I(13,"input",8),o(14,"translate"),E(15,ta,4,8,"small",5)(16,aa,3,5,"small",5),r(),s(17,"div",6)(18,"label",9),d(19),o(20,"translate"),r(),I(21,"input",10),o(22,"translate"),E(23,na,4,8,"small",5)(24,ra,3,5,"small",5),r(),s(25,"div",2),E(26,oa,3,2,"div",11)(27,sa,3,3),r()()(),s(28,"div",12)(29,"p-button",13),o(30,"translate"),h("onClick",function(){return i.close()}),r(),s(31,"p-button",14),o(32,"translate"),o(33,"translate"),h("onClick",function(){return i.save()}),r()()),a&2&&(p("formGroup",i.brandForm),n(4),C(c(5,20,"FIELDS.CLASSIFICATIONS")),n(2),p("options",i.classifications)("filter",!0)("showClear",!0)("placeholder",c(7,22,"FIELDS.CLASSIFICATIONS")),n(2),O(i.formError.hasSpecificError("classificationIds","required")?8:-1),n(3),C(c(12,24,"FIELDS.ENGLISH_NAME")),n(2),p("ngClass",S(38,Zi,i.formError.hasError("englishName")))("placeholder",c(14,26,"FIELDS.ENGLISH_NAME")),n(2),O(i.formError.hasSpecificError("englishName","required")?15:-1),n(),O(i.formError.hasSpecificError("englishName","maxlength")?16:-1),n(3),C(c(20,28,"FIELDS.ARABIC_NAME")),n(2),p("ngClass",S(40,Zi,i.formError.hasError("arabicName")))("placeholder",c(22,30,"FIELDS.ARABIC_NAME")),n(2),O(i.formError.hasSpecificError("arabicName","required")?23:-1),n(),O(i.formError.hasSpecificError("arabicName","maxlength")?24:-1),n(2),O(i.brand.icon!=null&&i.brand.icon.blobUrI?26:27),n(3),p("label",c(30,32,"GENERAL.CANCEL")),n(2),p("label",i.brand.id?c(32,34,"GENERAL.UPDATE"):c(33,36,"GENERAL.SAVE")))},dependencies:[L,Ue,z,Pe,Q,q,W,Z,J,$,H,te,re,_e,X,ee,x,w,Ne,Ae]})}return t})();var Ii={columns:[{field:"name",header:"BRANDNAME",type:"label",exported:!1},{field:"classifications",header:"CLASSIFICATION",type:"label",exported:!0},{field:"actions",header:"ACTIONS",type:"actions",exported:!1}],rowsPerPage:10,rowsPerPageOptions:[5,10,15,20,25,50,100],selectionMode:"single",locale:"FIELDS.",actions:["CREATE"],rowsActions:["EDIT","DELETE"],dataLoading:"server",paginator:!0,globalFilterFields:["name"],hasFilters:!0};function la(t,u){if(t&1&&(s(0,"div",6)(1,"div"),d(2),r()()),t&2){let e=u.$implicit;n(2),C(e.name)}}var cs=(()=>{class t{_brands;_confirm;_translate;_popup;_toast;destroy$=new R;tableConfig$;filters={number:1,size:10};searchControl=new he;classifications=[];currentPage=1;totalRecords=0;first=0;pageSize=10;rows=10;selectedClassification=null;constructor(e,a,i,l,m){this._brands=e,this._confirm=a,this._translate=i,this._popup=l,this._toast=m}ngOnInit(){this.getAllBrand(this.filters),this.getClassifications()}getAllBrand(e){this._brands.getBrands(e).pipe(ge(a=>y(T({},Ii),{rows:a.data?.result.map(i=>y(T({},i),{classifications:(i.classifications||[]).map(l=>l.name)}))||[],totalRecords:a.data?.rowCount}))).subscribe({next:a=>{this.tableConfig$=Ee(a)}})}onActionClicked(e){switch(e.action){case"CREATE":this.createBrand();break;case"EDIT":this.editBrand(e.data);break;case"DELETE":this.deleteBrand(e.data);break}}createBrand(){this._popup.open(Si,{title:this._translate.instant("BRANDS.ADD_NEW_BRAND"),position:this._translate.currentLang==="ar"?"left":"right"}).afterClosed.subscribe(e=>e&&this.getAllBrand(this.filters))}editBrand(e){this._popup.open(Si,{title:this._translate.instant("BRANDS.EDIT_BRAND"),position:this._translate.currentLang==="ar"?"left":"right",data:e}).afterClosed.subscribe(a=>a&&this.getAllBrand(this.filters))}deleteBrand(e){e.id&&this._confirm.confirm("delete").subscribe(a=>{a&&this._brands.deleteBrand(e.id).pipe(b(this.destroy$)).subscribe(()=>{this._toast.success(this._translate.instant("BRANDS.DELETE_BRAND_SUCCESS")),this.getAllBrand(this.filters)})})}getClassifications(){this._brands.getClassifications().pipe(b(this.destroy$)).subscribe(e=>{this.classifications=e.data.classifications})}onClassificationChange(e){this.selectedClassification=e.value,this.filterWithClassifications()}filterWithClassifications(){this.selectedClassification?this._brands.getBrands({size:this.rows,number:this.currentPage}).pipe(b(this.destroy$)).subscribe({next:e=>{let a=e.data.result.filter(i=>i.classifications.some(l=>l.id===this.selectedClassification?.id));this.tableConfig$=Ee(y(T({},Ii),{rows:a.map(i=>y(T({},i),{classifications:(i.classifications||[]).map(l=>l.name).join(", ")}))||[],totalRecords:a.length}))}}):this.getAllBrand({size:this.rows,number:this.currentPage})}onPageChange(e){this.first=e.first||0,this.rows=e.rows||10,this.currentPage=e.page||1,console.log("PageSize:",this.rows,"PageNumber:",this.currentPage),this.getAllBrand({size:this.rows,number:this.currentPage})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(a){return new(a||t)(f(oi),f(ne),f(V),f(P),f(G))};static \u0275cmp=D({type:t,selectors:[["admin-brands"]],standalone:!0,features:[F],decls:9,vars:9,consts:[[3,"actionClicked","onSearch","onPage","config"],["filters-area","",1,"filters","p-grid"],[1,"filters-item","col-2","p-0"],[1,"filters-actions","col-4","p-0"],["formControlName","classification","optionLabel","name","filterBy","name","placeholder","Select a classifications",1,"w-full",3,"onChange","options","filter","showClear"],["pTemplate","selectedItem"],[1,"flex","align-items-center","gap-2"]],template:function(a,i){a&1&&(s(0,"shared-ui-table",0),o(1,"async"),h("actionClicked",function(m){return i.onActionClicked(m)})("onSearch",function(m){return i.searchControl.patchValue(m)})("onPage",function(m){return i.onPageChange(m)}),s(2,"div",1)(3,"div",2),d(4),o(5,"translate"),r(),s(6,"div",3)(7,"p-dropdown",4),h("onChange",function(m){return i.onClassificationChange(m)}),E(8,la,3,1,"ng-template",5),r()()()()),a&2&&(p("config",c(1,5,i.tableConfig$)),n(4),C(c(5,7,"GENERAL.FILTERS")),n(3),p("options",i.classifications)("filter",!0)("showClear",!0))},dependencies:[L,Se,oe,H,$,ie,ae,re,pe,x,w],encapsulation:2})}return t})();var $e=t=>({fieldName:t}),si=()=>({maxLength:50});function pa(t,u){if(t&1&&(s(0,"div",11)(1,"div"),d(2),r()()),t&2){let e=u.$implicit;n(2),C(e.name)}}function ca(t,u){t&1&&(s(0,"div",16),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,$e,c(2,1,"FIELDS.CLASSIFICATION")))," "))}function da(t,u){t&1&&(s(0,"div",16),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,$e,c(2,1,"FIELDS.SHORT_ARABIC_NAME")))," "))}function ma(t,u){t&1&&(s(0,"div",16),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,si))," "))}function ua(t,u){t&1&&(s(0,"div",16),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,$e,c(2,1,"FIELDS.ENGLISH_NAME")))," "))}function fa(t,u){t&1&&(s(0,"div",16),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,si))," "))}function ha(t,u){t&1&&(s(0,"div",16),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,$e,c(2,1,"FIELDS.SHORT_ARABIC_NAME")))," "))}function _a(t,u){t&1&&(s(0,"div",16),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,si))," "))}function ga(t,u){t&1&&(s(0,"div",16),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,$e,c(2,1,"FIELDS.SHORT_ENGLISH_NAME")))," "))}function Ea(t,u){t&1&&(s(0,"div",16),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,si))," "))}var Ki=(()=>{class t{_fb;classifications=[];unitData;addUnitForm;save=new yi;constructor(e){this._fb=e}ngOnInit(){if(this.prepareForm(),this.unitData&&(this.addUnitForm.patchValue(this.unitData),this.unitData.classificationId)){let e=Number(this.unitData.classificationId),a=this.classifications.find(i=>i.id===e);a&&this.addUnitForm.get("classification")?.setValue(a)}}prepareForm(){this.addUnitForm=this._fb.group({childId:[],arabicName:[null,[v.required,v.maxLength(20)]],englishName:[null,[v.required,v.maxLength(20)]],classificationId:[null,v.required],classification:[null,v.required],shortArabicName:[null,[v.required,v.maxLength(20)]],shortEnglishName:[null,[v.required,v.maxLength(20)]],isDecimal:[!0]})}get control(){return this.addUnitForm.controls}onClassificationChange(e){this.addUnitForm.get("classificationId")?.setValue(e.value.id),this.addUnitForm.get("classification")?.setValue(e.value)}onSave(){this.addUnitForm.valid?this.save.emit(this.addUnitForm.value):this.addUnitForm.markAllAsTouched()}static \u0275fac=function(a){return new(a||t)(f(K))};static \u0275cmp=D({type:t,selectors:[["admin-add-edit-units"]],inputs:{classifications:"classifications",unitData:"unitData"},outputs:{save:"save"},standalone:!0,features:[F],decls:37,vars:37,consts:[[1,"form-content",3,"formGroup"],[1,"row"],[1,"col-12"],["formControlName","classification","optionLabel","name","filterBy","name",3,"onChange","options","filter","showClear","placeholder"],["pTemplate","selectedItem"],["class","error-message",4,"ngIf"],[1,"col-6"],["type","text","pInputText","","appEliminateSpecialChars","","formControlName","arabicName",1,"w-full",3,"placeholder"],["type","text","pInputText","","appEliminateSpecialChars","","formControlName","englishName",1,"w-full",3,"placeholder"],["type","text","pInputText","","appEliminateSpecialChars","","formControlName","shortArabicName",1,"w-full",3,"placeholder"],["type","text","pInputText","","appEliminateSpecialChars","","formControlName","shortEnglishName",1,"w-full",3,"placeholder"],[1,"flex","align-items-center","gap-2"],["formControlName","isDecimal","inputId","binary",3,"binary"],["for","ny"],[1,"col-3"],[1,"p-element","btn-tasheel","btn-primary","w-full",3,"onClick","label"],[1,"error-message"]],template:function(a,i){a&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-dropdown",3),o(4,"translate"),h("onChange",function(m){return i.onClassificationChange(m)}),E(5,pa,3,1,"ng-template",4),r(),E(6,ca,4,8,"div",5),r(),s(7,"div",6),I(8,"input",7),o(9,"translate"),E(10,da,4,8,"div",5)(11,ma,3,5,"div",5),r(),s(12,"div",6),I(13,"input",8),o(14,"translate"),E(15,ua,4,8,"div",5)(16,fa,3,5,"div",5),r(),s(17,"div",6),I(18,"input",9),o(19,"translate"),E(20,ha,4,8,"div",5)(21,_a,3,5,"div",5),r(),s(22,"div",6),I(23,"input",10),o(24,"translate"),E(25,ga,4,8,"div",5)(26,Ea,3,5,"div",5),r(),s(27,"div",2)(28,"div",11),I(29,"p-checkbox",12),s(30,"label",13),d(31),o(32,"translate"),r()()(),s(33,"div",14)(34,"p-button",15),o(35,"translate"),o(36,"translate"),h("onClick",function(){return i.onSave()}),r()()()()),a&2&&(p("formGroup",i.addUnitForm),n(3),p("options",i.classifications)("filter",!0)("showClear",!0)("placeholder",c(4,21,"FIELDS.CLASSIFICATION")),n(3),p("ngIf",i.control.classification.touched&&(i.control.classification.errors==null?null:i.control.classification.errors.required)),n(2),p("placeholder",c(9,23,"FIELDS.SHORT_ARABIC_NAME")),n(2),p("ngIf",i.control.arabicName.touched&&(i.control.arabicName.errors==null?null:i.control.arabicName.errors.required)),n(),p("ngIf",i.control.arabicName.touched&&(i.control.arabicName.errors==null?null:i.control.arabicName.errors.maxlength)),n(2),p("placeholder",c(14,25,"FIELDS.ENGLISH_NAME")),n(2),p("ngIf",i.control.englishName.touched&&(i.control.englishName.errors==null?null:i.control.englishName.errors.required)),n(),p("ngIf",i.control.englishName.touched&&(i.control.englishName.errors==null?null:i.control.englishName.errors.maxlength)),n(2),p("placeholder",c(19,27,"FIELDS.SHORT_ARABIC_NAME")),n(2),p("ngIf",i.control.shortArabicName.touched&&(i.control.shortArabicName.errors==null?null:i.control.shortArabicName.errors.required)),n(),p("ngIf",i.control.shortArabicName.touched&&(i.control.shortArabicName.errors==null?null:i.control.shortArabicName.errors.maxlength)),n(2),p("placeholder",c(24,29,"FIELDS.SHORT_ENGLISH_NAME")),n(2),p("ngIf",i.control.shortEnglishName.touched&&(i.control.shortEnglishName.errors==null?null:i.control.shortEnglishName.errors.required)),n(),p("ngIf",i.control.shortEnglishName.touched&&(i.control.shortEnglishName.errors==null?null:i.control.shortEnglishName.errors.maxlength)),n(3),p("binary",!0),n(2),C(c(32,31,"FIELDS.ALLOW_DECIMAL")),n(3),p("label",i.unitData?c(35,33,"GENERAL.UPDATE"):c(36,35,"GENERAL.SAVE")))},dependencies:[L,fe,le,Q,q,W,$,ie,ae,x,w,Te,ki,z,Z,J,H,te,Ui,X,ee]})}return t})();var li={columns:[{field:"name",header:"UNIT_NAME",type:"label",exported:!1},{field:"shortName",header:"SHORT_NAME",type:"label",exported:!1},{field:"classification",header:"CLASSIFICATION",type:"label",exported:!1},{field:"actions",header:"ACTIONS",type:"actions",exported:!1}],rowsPerPage:10,rowsPerPageOptions:[5,10,15,20,25,50,100],selectionMode:"single",locale:"FIELDS.",actions:["CREATE"],rowsActions:["EDIT","DELETE"],dataLoading:"server",paginator:!0};var Ca=()=>({width:"600px",height:"100vh",top:"0",margin:"0",padding:"0"});function va(t,u){if(t&1&&(s(0,"div",11)(1,"div"),d(2),r()()),t&2){let e=u.$implicit;n(2),C(e.name)}}function ba(t,u){if(t&1){let e=j();s(0,"div",12)(1,"div",13),d(2),o(3,"translate"),r(),s(4,"button",14),h("click",function(){M(e);let i=N();return U(i.displayDialog=!1)}),I(5,"img",15),r()()}t&2&&(n(2),C(c(3,1,"UNITS.ADD_NEW_UNIT")))}function Sa(t,u){if(t&1){let e=j();s(0,"admin-add-edit-units",16),h("save",function(i){M(e);let l=N();return U(l.handleSave(i))}),r()}if(t&2){let e=N();p("classifications",e.classifications)("unitData",e.selectedUnit)}}var Hs=(()=>{class t{_toastr;_confirm;_translate;_product;_unsubscribeAll=new R;displayDialog=!1;pageSize=10;pageNumber=1;totalRecords=0;first=0;keyword="";searchControl=new he;breadcrumb;tableConfig;classifications=[];selectedClassification=null;constructor(e,a,i,l){this._toastr=e,this._confirm=a,this._translate=i,this._product=l}ngOnInit(){this.tableConfig=li,this.setBreadcrumb(),this.getClassifications(),this.getAllUnits(),this.onSearch(),this._translate.onLangChange.pipe(b(this._unsubscribeAll)).subscribe(e=>{this.setBreadcrumb()})}setBreadcrumb(){this.breadcrumb=[{icon:"pi pi-home",route:"/"},{label:this._translate.instant("UNITS.PRODUCT_MANAGEMENT")},{label:this._translate.instant("UNITS.NAME"),route:"/units"}]}getClassifications(){this._product.getClassifications().pipe(b(this._unsubscribeAll)).subscribe(e=>{this.classifications=e.data.classifications})}getAllUnits(){this._product.getAllUnits(this.pageSize,this.pageNumber,this.keyword).pipe(b(this._unsubscribeAll)).subscribe(e=>{this.tableConfig=y(T({},li),{rows:e.data.result.map(a=>y(T({},a),{classification:a.classification?.name}))||[],totalRecords:e.data.rowCount,rowsActions:["EDIT","DELETE"]})})}onPageChange(e){this.first=e.first||0,this.pageSize=e.rows||10,this.pageNumber=e.page||1,this.getAllUnits()}onActionClicked(e){switch(e.action){case"CREATE":this.selectedUnit=null,this.openCreateDialog();break;case"EDIT":this.getUnitById(e.data);break;case"DELETE":this.onActionDelete(e.data);break;default:break}}openCreateDialog(){this.displayDialog=!0}onDialogClose(){this.displayDialog=!1}onActionDelete(e){this._confirm.confirm("delete").subscribe(a=>{a&&this._product.deleteUnit(e.id).pipe(b(this._unsubscribeAll)).subscribe(i=>{i.data&&this.getAllUnits()})})}handleSave(e){this.selectedUnit?this._product.editUnit(y(T({},e),{id:this.selectedUnit.id})).pipe(b(this._unsubscribeAll)).subscribe(a=>{a.data&&(this._toastr.success(this._translate.instant("GENERAL.UPDATED_SUCCESSFULLY",{name:this._translate.instant("UNITS.NAME")})),this.getAllUnits(),this.displayDialog=!1)}):this._product.addUnit(e).pipe(b(this._unsubscribeAll)).subscribe(()=>{this.getAllUnits(),this.displayDialog=!1,this._toastr.success(this._translate.instant("GENERAL.ADDED_SUCCESSFULLY",{name:this._translate.instant("UNITS.NAME")}))})}selectedUnit=null;getUnitById(e){let a=typeof e.id=="string"?Number(e.id):e.id;a&&this._product.getUnitById(a).subscribe(i=>{i.data&&(this.displayDialog=!0,this.selectedUnit=i.data)})}onClassificationChange(e){this.selectedClassification=e.value,this.filterUnits()}filterUnits(){this.selectedClassification?this._product.getAllUnits(this.pageSize,this.pageNumber,this.keyword).pipe(b(this._unsubscribeAll)).subscribe(e=>{let a=e.data.result.filter(i=>i.classification?.id===this.selectedClassification?.id);this.tableConfig.rows=a.map(i=>y(T({},i),{classification:i.classification?.name}))}):this.getAllUnits()}onSearch(){this.searchControl.valueChanges.pipe(Be(e=>e.trim().length>=0),xe(400),Re(e=>this._product.getAllUnits(this.pageSize,this.pageNumber,e.trim()))).subscribe(e=>{e&&e.data&&(this.tableConfig=y(T({},li),{rows:e.data.result.map(a=>y(T({},a),{classification:a.classification?.name}))||[],totalRecords:e.data.rowCount,rowsActions:["EDIT","DELETE"]}))})}ngOnDestroy(){this._unsubscribeAll.next(),this._unsubscribeAll.complete()}static \u0275fac=function(a){return new(a||t)(f(G),f(ne),f(V),f(ce))};static \u0275cmp=D({type:t,selectors:[["admin-units"]],standalone:!0,features:[F],decls:13,vars:19,consts:[[1,"dialog-side"],[3,"items"],[3,"onPage","onSearch","actionClicked","config"],["filters-area","",1,"filters","row"],[1,"filters-item","col-2","p-0"],[1,"filters-actions","col-4","p-0"],["formControlName","classification","optionLabel","name","filterBy","name","placeholder","Select a classifications",1,"w-full",3,"onChange","options","filter","showClear"],["pTemplate","selectedItem"],[3,"visibleChange","visible","modal","dismissableMask","position","baseZIndex","draggable","blockScroll","closable"],["pTemplate","header"],["pTemplate","content"],[1,"flex","align-items-center","gap-2"],[1,"dialog-header"],[1,"dialog-header__title"],[1,"dialog-header__close-button",3,"click"],["src","assets/layout/images/close-icon.svg","alt","Close",1,"dialog-header__close-icon"],[3,"save","classifications","unitData"]],template:function(a,i){a&1&&(s(0,"section",0),I(1,"pos-ui-breadcrumb",1),s(2,"shared-ui-table",2),h("onPage",function(m){return i.onPageChange(m)})("onSearch",function(m){return i.searchControl.patchValue(m)})("actionClicked",function(m){return i.onActionClicked(m)}),s(3,"div",3)(4,"div",4),d(5),o(6,"translate"),r(),s(7,"div",5)(8,"p-dropdown",6),h("onChange",function(m){return i.onClassificationChange(m)}),E(9,va,3,1,"ng-template",7),r()()()(),s(10,"p-dialog",8),ze("visibleChange",function(m){return qe(i.displayDialog,m)||(i.displayDialog=m),m}),E(11,ba,6,3,"ng-template",9)(12,Sa,1,2,"ng-template",10),r()()),a&2&&(n(),p("items",i.breadcrumb),n(),p("config",i.tableConfig),n(3),C(c(6,16,"GENERAL.FILTERS")),n(3),p("options",i.classifications)("filter",!0)("showClear",!0),n(2),Di(A(18,Ca)),He("visible",i.displayDialog),p("modal",!0)("dismissableMask",!0)("position","right")("baseZIndex",1e4)("draggable",!1)("blockScroll",!0)("closable",!1))},dependencies:[L,oe,$,ie,ae,Ki,x,w,Mi,pe,Pi],encapsulation:2})}return t})();var pi=(()=>{class t{_http;constructor(e){this._http=e}getClassifications(){return this._http.get(`${B.URL_API}Classifications`)}getAllTags(e){return this._http.get(`${B.URL_API}Tags?TagTypeIds=2&PageSize=${e.size}&PageNumber=${e.number}`)}deleteTags(e){return this._http.delete(`${B.URL_API}Tags/${e}`)}addTags(e){return this._http.post(`${B.URL_API}Tags`,e)}editTags(e){return this._http.put(`${B.URL_API}Tags`,e)}getTagsById(e){return this._http.get(`/api/Tags/${e}`)}static \u0275fac=function(a){return new(a||t)(ve(Ie))};static \u0275prov=Ce({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var it=t=>({"ng-dirty ng-invalid":t}),Ai=t=>({fieldName:t}),tt=()=>({maxLength:50});function Ia(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,Ai,c(2,1,"FIELDS.classificationIds")))," "))}function Aa(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,Ai,c(2,1,"FIELDS.ENGLISH_NAME")))," "))}function Na(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,tt))," "))}function Ta(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),o(3,"translate"),r()),t&2&&(n(),_(" ",g(3,3,"GENERAL.FIELD_REQUIRED",S(6,Ai,c(2,1,"FIELDS.ARABIC_NAME")))," "))}function ya(t,u){t&1&&(s(0,"small",5),d(1),o(2,"translate"),r()),t&2&&(n(),_(" ",g(2,1,"GENERAL.MAX_LENGTH_EXCEEDED",A(4,tt))," "))}var Ni=(()=>{class t{_tag;_popup;_translate;_toastr;_fb;destroy$=new R;formError;tagForm;tag;classifications=[];selectedTag;constructor(e,a,i,l,m){this._tag=e,this._popup=a,this._translate=i,this._toastr=l,this._fb=m}ngOnInit(){this.tag=this._popup.getData(),this.tagForm=this.initForm(),this.formError=new Ge.ErrorManagement(this.tagForm),this.tag&&this.tag.tagId&&this.getTagsDetails({tagId:this.tag.tagId}),this.getClassifications()}getClassifications(){this._tag.getClassifications().pipe(b(this.destroy$)).subscribe({next:e=>{this.classifications=e.data.classifications}})}getTagsDetails(e){let a=typeof e.tagId=="string"?Number(e.tagId):e.tagId;a&&!isNaN(a)&&this._tag.getTagsById(a).subscribe(i=>{i.data&&(this.selectedTag=i.data,this.selectedTag.classificationIds=(this.selectedTag.classificationIds||[]).map(l=>l.id),this.patchFormData())})}initForm(){return this._fb.group({classificationIds:[[],[v.required]],arabicName:["",[v.required]],englishName:["",[v.required]],TagTypeId:[2]})}patchFormData(){this.tagForm.patchValue({classificationIds:this.selectedTag.classificationIds||[],arabicName:this.selectedTag.arabicName,englishName:this.selectedTag.englishName})}save(){let e=this.tagForm.getRawValue();(e.id?this._tag.editTags(e):this._tag.addTags(e)).pipe(b(this.destroy$)).subscribe(()=>this.afterSavingDone(e.id?"edit":"add",e))}afterSavingDone(e,a){let i=this._translate.currentLang==="ar"?a?.arabicName:a?.englishName;this._translate.get(e?"GENERAL.ADDED_SUCCESSFULLY":"UPDATED_SUCCESSFULLY",{name:i}).subscribe(l=>this._toastr.success(l)),this._popup.close(!0)}close=()=>this._popup.close();onClassificationChange(e){this.tagForm.get("classificationId")?.setValue(e.value.id),this.tagForm.get("classification")?.setValue(e.value)}static \u0275fac=function(a){return new(a||t)(f(pi),f(P),f(V),f(G),f(K))};static \u0275cmp=D({type:t,selectors:[["admin-tags-form"]],standalone:!0,features:[F],decls:31,vars:41,consts:[["autocomplete","off",3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12"],["for","classificationIds"],["formControlName","classificationIds","optionLabel","name","optionValue","id","filterBy","name",3,"onChange","options","filter","showClear","placeholder"],["id","serviceType-error",1,"text-error"],[1,"field","col-12","md:col-6"],["for","englishName"],["pInputText","","type","text","pInputText","","formControlName","englishName",1,"w-full",3,"ngClass","placeholder"],["for","arabicName"],["type","text","pInputText","","formControlName","arabicName",1,"w-full",3,"ngClass","placeholder"],[1,"flex","gap-2","align-items-center","justify-content-end"],["severity","danger",3,"onClick","label"],["severity","primary",3,"onClick","label"]],template:function(a,i){a&1&&(s(0,"form",0)(1,"div",1)(2,"div",2)(3,"label",3),d(4),o(5,"translate"),r(),s(6,"p-multiSelect",4),o(7,"translate"),h("onChange",function(m){return i.onClassificationChange(m)}),r(),E(8,Ia,4,8,"small",5),r(),s(9,"div",6)(10,"label",7),d(11),o(12,"translate"),r(),I(13,"input",8),o(14,"translate"),E(15,Aa,4,8,"small",5)(16,Na,3,5,"small",5),r(),s(17,"div",6)(18,"label",9),d(19),o(20,"translate"),r(),I(21,"input",10),o(22,"translate"),E(23,Ta,4,8,"small",5)(24,ya,3,5,"small",5),r()()(),s(25,"div",11)(26,"p-button",12),o(27,"translate"),h("onClick",function(){return i.close()}),r(),s(28,"p-button",13),o(29,"translate"),o(30,"translate"),h("onClick",function(){return i.save()}),r()()),a&2&&(p("formGroup",i.tagForm),n(4),C(c(5,19,"FIELDS.CLASSIFICATIONS")),n(2),p("options",i.classifications)("filter",!0)("showClear",!0)("placeholder",c(7,21,"FIELDS.CLASSIFICATIONS")),n(2),O(i.formError.hasSpecificError("classificationIds","required")?8:-1),n(3),C(c(12,23,"FIELDS.ENGLISH_NAME")),n(2),p("ngClass",S(37,it,i.formError.hasError("englishName")))("placeholder",c(14,25,"FIELDS.ENGLISH_NAME")),n(2),O(i.formError.hasSpecificError("englishName","required")?15:-1),n(),O(i.formError.hasSpecificError("englishName","maxlength")?16:-1),n(3),C(c(20,27,"FIELDS.ARABIC_NAME")),n(2),p("ngClass",S(39,it,i.formError.hasError("arabicName")))("placeholder",c(22,29,"FIELDS.ARABIC_NAME")),n(2),O(i.formError.hasSpecificError("arabicName","required")?23:-1),n(),O(i.formError.hasSpecificError("arabicName","maxlength")?24:-1),n(2),p("label",c(27,31,"GENERAL.CANCEL")),n(2),p("label",i.tag.id?c(29,33,"GENERAL.UPDATE"):c(30,35,"GENERAL.SAVE")))},dependencies:[L,Ue,z,Pe,Q,q,W,Z,J,$,H,te,re,_e,X,ee,x,w],encapsulation:2})}return t})();var Ti={columns:[{field:"tagName",header:"TAGNAME",type:"label",exported:!1},{field:"classifications",header:"CLASSIFICATION",type:"label",exported:!1},{field:"actions",header:"ACTIONS",type:"actions",exported:!1}],rowsPerPage:10,rowsPerPageOptions:[5,10,15,20,25,50,100],selectionMode:"single",actions:["CREATE"],rowsActions:["EDIT","DELETE"],dataLoading:"server",paginator:!0,globalFilterFields:["tagName","classifications"],locale:"FIELDS.",hasFilters:!0};function Da(t,u){if(t&1&&(s(0,"div",6)(1,"div"),d(2),r()()),t&2){let e=u.$implicit;n(2),C(e.name)}}var Bl=(()=>{class t{tagService;confirmService;translateService;popupService;toastrService;destroy$=new R;tableConfig$;searchControl=new he;classifications=[];currentPage=1;totalRecords=0;first=0;pageSize=10;rows=10;selectedClassification=null;filters={number:1,size:10};constructor(e,a,i,l,m){this.tagService=e,this.confirmService=a,this.translateService=i,this.popupService=l,this.toastrService=m}ngOnInit(){this.getTags(this.filters),this.getClassifications()}getTags(e){this.tagService.getAllTags(e).pipe(ge(a=>y(T({},Ti),{rows:a.data.result.map(i=>y(T({},i),{classifications:(i.classifications||[]).map(l=>l.name).join(", ")}))||[],totalRecords:a.data.rowCount}))).subscribe({next:a=>this.tableConfig$=Ee(a)})}onActionClicked(e){switch(e.action){case"CREATE":this.createTags();break;case"EDIT":this.editTags(e.data);break;case"DELETE":this.deleteTags(e.data);break}}createTags(){this.popupService.open(Ni,{title:this.translateService.instant("TAGS.ADD_NEW_TAG"),position:this.translateService.currentLang==="ar"?"left":"right"}).afterClosed.subscribe(e=>{e&&this.getTags(this.filters)})}editTags(e){this.popupService.open(Ni,{title:this.translateService.instant("Tags.EDIT_TAG"),position:this.translateService.currentLang==="ar"?"left":"right",data:e}).afterClosed.subscribe(a=>{a&&this.getTags(this.filters)})}deleteTags(e){e.tagId&&this.confirmService.confirm("delete").subscribe(a=>{a&&this.tagService.deleteTags(e.tagId).pipe(b(this.destroy$)).subscribe(i=>{i.data&&(this.toastrService.success("Tag deleted successfully"),this.getTags({size:this.rows,number:this.currentPage}))})})}getClassifications(){this.tagService.getClassifications().pipe(b(this.destroy$)).subscribe(e=>{this.classifications=e.data.classifications})}onClassificationChange(e){this.selectedClassification=e.value,this.filterWithClassifications()}filterWithClassifications(){this.selectedClassification?this.tagService.getAllTags({size:this.rows,number:this.currentPage}).pipe(b(this.destroy$)).subscribe(e=>{let a=e.data.result.filter(i=>i.classifications?.some(l=>l.id===this.selectedClassification?.id)??!1);this.tableConfig$=Ee(y(T({},Ti),{rows:a.map(i=>y(T({},i),{classifications:(i.classifications||[]).map(l=>l.name).join(", ")}))||[],totalRecords:a.length}))}):this.getTags({size:this.rows,number:this.currentPage})}onPageChange(e){this.first=e.first||0,this.rows=e.rows||10,this.currentPage=e.page||1,this.getTags({size:this.rows,number:this.currentPage})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static \u0275fac=function(a){return new(a||t)(f(pi),f(ne),f(V),f(P),f(G))};static \u0275cmp=D({type:t,selectors:[["admin-tags"]],standalone:!0,features:[F],decls:9,vars:9,consts:[[3,"actionClicked","onSearch","onPage","config"],["filters-area","",1,"filters","p-grid"],[1,"filters-item","col-2","p-0"],[1,"filters-actions","col-4","p-0"],["formControlName","classification","optionLabel","name","filterBy","name","placeholder","Select a classifications",1,"w-full",3,"onChange","options","filter","showClear"],["pTemplate","selectedItem"],[1,"flex","align-items-center","gap-2"]],template:function(a,i){a&1&&(s(0,"shared-ui-table",0),o(1,"async"),h("actionClicked",function(m){return i.onActionClicked(m)})("onSearch",function(m){return i.searchControl.patchValue(m)})("onPage",function(m){return i.onPageChange(m)}),s(2,"div",1)(3,"div",2),d(4),o(5,"translate"),r(),s(6,"div",3)(7,"p-dropdown",4),h("onChange",function(m){return i.onClassificationChange(m)}),E(8,Da,3,1,"ng-template",5),r()()()()),a&2&&(p("config",c(1,5,i.tableConfig$)),n(4),C(c(5,7,"GENERAL.FILTERS")),n(3),p("options",i.classifications)("filter",!0)("showClear",!0))},dependencies:[L,Se,oe,H,$,ie,ae,re,pe,x,w],encapsulation:2})}return t})();export{un as a,vr as b,Io as c,cs as d,Hs as e,Bl as f};
